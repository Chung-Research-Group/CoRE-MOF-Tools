

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CoREMOF.mosaec &mdash; CoREMOF 0.1.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
      <script src="../../_static/jquery.js"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CoREMOF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CoREMOF.html">CoREMOF package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">setup module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">CoREMOF_tools API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CoREMOF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CoREMOF.mosaec</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CoREMOF.mosaec</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Code for MOSAEC checker. Ref: White, A.; Gibaldi, M.; Burner, J.; Woo, T. K. Alarming Structural Error Rates in MOF Databases Used in Computational Screening Identified via a Novel Metal Oxidation State-Based Method. ChemRxiv 2024. https://doi.org/10.26434/chemrxiv-2024-ftsv3.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="c1"># handle differing python versions (&lt; 3.8, &amp; &gt; 3.9) of CSD python API</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">mendeleev</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc</span><span class="w"> </span><span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc</span><span class="w"> </span><span class="kn">import</span> <span class="n">crystal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc</span><span class="w"> </span><span class="kn">import</span> <span class="n">molecule</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc.crystal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Crystal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc.molecule</span><span class="w"> </span><span class="kn">import</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Molecule</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ccdc</span><span class="w"> </span><span class="kn">import</span> <span class="n">descriptors</span>


<div class="viewcode-block" id="readentry"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.readentry">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">readentry</span><span class="p">(</span><span class="n">input_cif</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a CIF file containing structure data and converts it to a</span>
<span class="sd">    standard atom labeling convention using the ccdc.crystal module.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_cif (str): filename (.CIF) containing crystal structure data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        newcif (ccdc.crystal.Crystal): Crystal object containing structural data</span>
<span class="sd">                                       in the standard atom labeling convention.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># read in the cif to a crystal object</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">CrystalReader</span><span class="p">(</span><span class="n">input_cif</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;cif&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readcif</span><span class="p">:</span>
        <span class="n">cif</span> <span class="o">=</span> <span class="n">readcif</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">readcif</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># to remove duplicate atoms, need the empirical formula</span>
    <span class="n">formula</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">formula</span>
    <span class="n">elamnt</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="c1"># now convert to standard labelling convention and identify</span>
    <span class="c1"># duplicate atoms to be removed</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_cif</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">newstring</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">loop_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">columncount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">type_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">z_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c1"># locate atom type and site label columns</span>
            <span class="k">if</span> <span class="s2">&quot;loop_&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">loop_pos</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;_atom&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;_geom&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;_aniso&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">loop_pos</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;atom_site_type_symbol&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">type_pos</span> <span class="o">=</span> <span class="n">columncount</span>
            <span class="k">if</span> <span class="s2">&quot;atom_site_label&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">label_pos</span> <span class="o">=</span> <span class="n">columncount</span>
            <span class="n">columncount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">counting</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s2">&quot;loop_&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="c1"># lines with atom information will contain a ., so only look at these</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="c1"># split lines by whitespace</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># keep count of how many of each element type</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">counting</span><span class="p">:</span>
                    <span class="n">counting</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">counting</span><span class="p">:</span>
                    <span class="n">counting</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># new atom labels</span>
                <span class="n">newlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]</span><span class="si">}{</span><span class="n">counting</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">label_pos</span><span class="p">],</span> <span class="n">newlabel</span><span class="p">)</span>
                <span class="c1"># cutoff repeated atoms</span>
                <span class="k">if</span> <span class="n">newlabel</span> <span class="ow">in</span> <span class="n">elamnt</span><span class="p">:</span>
                    <span class="n">cutoff</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span> <span class="o">=</span> <span class="n">counting</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cutoff</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">counting</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">type_pos</span><span class="p">]]:</span>
                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># remove unnecessary atoms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># combine to new string</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">newstring</span> <span class="o">+=</span> <span class="n">i</span>
        <span class="c1"># read into new crystal object and assign bonds</span>
        <span class="n">newcif</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">Crystal</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">newstring</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;cif&quot;</span><span class="p">)</span>
        <span class="n">newcif</span><span class="o">.</span><span class="n">assign_bonds</span><span class="p">()</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">newcif</span></div>


<div class="viewcode-block" id="readSBU"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.readSBU">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">readSBU</span><span class="p">(</span><span class="n">input_mol2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a MOL2 file containing SBU/metal complex structural data</span>
<span class="sd">    and converts it to a standard atom labeling convention using</span>
<span class="sd">    the ccdc.crystal module.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_mol2 (str): filename (.mol2) containing SBU/metal complex</span>
<span class="sd">                          structural data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        mol (ccdc.crystal.Crystal): Crystal object containing structural data</span>
<span class="sd">                                    in the standard atom labeling convention.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First have to convert the connection points (unknown atom types)</span>
    <span class="c1"># to H. Has to be done as a string so CSD reader can</span>
    <span class="c1"># interpret bonding</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_mol2</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">newstring</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Du&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span>
            <span class="n">newstring</span> <span class="o">+=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cif</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">Crystal</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">newstring</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mol2&quot;</span><span class="p">)</span>
        <span class="n">cif</span><span class="o">.</span><span class="n">assign_bonds</span><span class="p">()</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">mol</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">molecule</span>
    <span class="c1"># MOSAEC needs atoms to have unique labels, so make them unique</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="si">}{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">mol</span></div>


<div class="viewcode-block" id="read_CSD_entry"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.read_CSD_entry">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_CSD_entry</span><span class="p">(</span><span class="n">input_refcode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read entries directly from the CSD CrystalReader according to CSD refcode.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_refcode (str): string used to identify materials in the CSD.</span>

<span class="sd">    Returns:</span>
<span class="sd">        cif (ccdc.crystal.Crystal): Crystal object containing structural data</span>
<span class="sd">                                    in the standard atom labeling convention.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># read in the cif to a crystal object</span>
    <span class="n">csd_crystal_reader</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">CrystalReader</span><span class="p">(</span><span class="s2">&quot;CSD&quot;</span><span class="p">)</span>
    <span class="n">cif</span> <span class="o">=</span> <span class="n">csd_crystal_reader</span><span class="o">.</span><span class="n">crystal</span><span class="p">(</span><span class="n">input_refcode</span><span class="p">)</span>
    <span class="n">cif</span><span class="o">.</span><span class="n">assign_bonds</span><span class="p">()</span>
    <span class="n">csd_crystal_reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cif</span></div>


<div class="viewcode-block" id="get_no_metal_molecule"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_no_metal_molecule">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_no_metal_molecule</span><span class="p">(</span><span class="n">inputmolecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Molecule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove metal atoms from the input Molecule object.</span>

<span class="sd">    Args:</span>
<span class="sd">        inputmolecule (ccdc.molecule.Molecule): original Molecule object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        workingmol (ccdc.molecule.Molecule): Molecule object with all metal</span>
<span class="sd">                                             atoms removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workingmol</span> <span class="o">=</span> <span class="n">inputmolecule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">workingmol</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">workingmol</span><span class="o">.</span><span class="n">remove_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">workingmol</span><span class="o">.</span><span class="n">assign_bond_types</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">workingmol</span></div>


<div class="viewcode-block" id="get_unique_sites"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_unique_sites">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_unique_sites</span><span class="p">(</span><span class="n">mole</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">asymmole</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the unique atoms in a structure belonging to the asymmetric unit.</span>

<span class="sd">    Args:</span>
<span class="sd">        mole (ccdc.molecule.Molecule): original structure Molecule object.</span>
<span class="sd">        asymmole (ccdc.molecule.Molecule): asymmetric unit of the structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        uniquesites (list[ccdc.molecule.Atom]): list of unique atoms in the structure</span>
<span class="sd">                                                that belong to the asymmetric unit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># blank list for unique sites</span>
    <span class="n">uniquesites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">asymmcoords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">molecoords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">asymmole</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="n">asymmcoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mole</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">in</span> <span class="n">asymmcoords</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">in</span> <span class="n">molecoords</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="n">uniquesites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                    <span class="n">molecoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">datom</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">uniquesites</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">(</span><span class="n">datom</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">datom</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">datom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">):</span>
                            <span class="n">uniquesites</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                            <span class="n">uniquesites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datom</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">datom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                        <span class="n">uniquesites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datom</span><span class="p">)</span>
                        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">uniquesites</span></div>


<div class="viewcode-block" id="get_metal_sites"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_metal_sites">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_metal_sites</span><span class="p">(</span><span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the metal sites in a structure belonging to the asymmetric unit.</span>

<span class="sd">    Args:</span>
<span class="sd">        sites (list[ccdc.molecule.Atom]): list of unique atoms in the structure</span>
<span class="sd">                                          that belong to the asymmetric unit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        metalsites (list[ccdc.molecule.Atom]): list of metal sites in the structure</span>
<span class="sd">                                               that belong to the asymmetric unit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metalsites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">is_metal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">metalsites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metalsites</span></div>


<div class="viewcode-block" id="get_ligand_sites"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_ligand_sites">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_ligand_sites</span><span class="p">(</span>
    <span class="n">metalsites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the ligand sites binding each metal atom in a structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        metalsites (list[ccdc.molecule.Atom]): list of metal sites in the structure</span>
<span class="sd">                                               that belong to the asymmetric unit.</span>
<span class="sd">        sites (list[ccdc.molecule.Atom]):  list of unique atoms in the structure</span>
<span class="sd">                                           that belong to the asymmetric unit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        metal_sphere (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                        dictionary with metal Atom object as keys and the the list</span>
<span class="sd">                        of ligand atoms which bind them as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metal_sphere</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalsites</span><span class="p">:</span>
        <span class="n">sphere1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ligand</span> <span class="ow">in</span> <span class="n">metal</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ligand</span><span class="o">.</span><span class="n">is_metal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ligand</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">site</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                        <span class="n">sphere1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="n">metal_sphere</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere1</span>
    <span class="k">return</span> <span class="n">metal_sphere</span></div>


<div class="viewcode-block" id="get_binding_sites"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_binding_sites">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_binding_sites</span><span class="p">(</span><span class="n">metalsites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">uniquesites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the binding sites in a structure, given the list of unique metal atoms</span>
<span class="sd">    and all unique atoms.</span>

<span class="sd">    Args:</span>
<span class="sd">        metalsites (list[ccdc.molecule.Atom]): list of unique metal atoms.</span>
<span class="sd">        uniquesites (list[ccdc.molecule.Atom]): list of unique atoms.</span>

<span class="sd">    Returns:</span>
<span class="sd">        binding_sites (list[ccdc.molecule.Atom]): list of binding sites connecting</span>
<span class="sd">                                                  metal atoms and ligands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">binding_sites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalsites</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ligand</span> <span class="ow">in</span> <span class="n">metal</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">uniquesites</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ligand</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">site</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                    <span class="n">binding_sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">binding_sites</span></div>


<div class="viewcode-block" id="ringVBOs"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.ringVBOs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">ringVBOs</span><span class="p">(</span><span class="n">mole</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the VBO (valence bond order) for each atom in the structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        mole (ccdc.molecule.Molecule): Molecule object representing the structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ringVBO (dict[int, int]): dictionary with each atom&#39;s index in mole.atoms</span>
<span class="sd">                                  as keys and VBO (valence bond order) as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ringVBO</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">unassigned</span> <span class="o">=</span> <span class="n">mole</span><span class="o">.</span><span class="n">atoms</span>
    <span class="n">ringcopy</span> <span class="o">=</span> <span class="n">mole</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">oncycle_atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offcycle_atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">oncycle_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offcycle_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cyclic_periodic</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cyclic_periodic_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offcycle_periodic</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># remove all the metals, this</span>
    <span class="c1"># prevents metal-containing rings (i.e. pores)</span>
    <span class="c1"># from interfering</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">ringcopy</span><span class="o">.</span><span class="n">remove_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

    <span class="c1"># collect all the cyclic atoms</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_cyclic</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">oncycle_atoms</span><span class="p">:</span>
                <span class="n">oncycle_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="n">oncycle_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="c1"># we also need everything that the cyclic atoms are bound to</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">oncycle_atoms</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">oncycle_atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">offcycle_atoms</span><span class="p">:</span>
                    <span class="n">offcycle_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbour</span><span class="p">)</span>
                    <span class="n">offcycle_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbour</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="c1"># combine cyclic atoms and 1st coordination sphere</span>
    <span class="n">cyclicsystem</span> <span class="o">=</span> <span class="n">oncycle_atoms</span> <span class="o">+</span> <span class="n">offcycle_atoms</span>

    <span class="c1"># initialize ringVBO dictionary</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">unassigned</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span><span class="p">:</span>
            <span class="n">ringVBO</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># CSD doesn&#39;t do periodic boundary conditions, need a workaround</span>
    <span class="c1"># check for any periodic copies of cyclic atoms</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([(</span><span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">oncycle_atoms</span><span class="p">),</span> <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">cyclic_periodic</span><span class="p">:</span>
                <span class="n">cyclic_periodic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="n">cyclic_periodic_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">cyclic_periodic</span><span class="p">:</span>
        <span class="c1"># print (atom.neighbours)</span>
        <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="p">(</span><span class="n">offcycle_periodic</span> <span class="o">+</span> <span class="n">cyclic_periodic</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oncycle_labels</span><span class="p">):</span>
                    <span class="n">offcycle_periodic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbour</span><span class="p">)</span>

    <span class="c1"># remove every atom that isn&#39;t part of or directly bound to a cycle</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cyclicsystem</span> <span class="o">+</span> <span class="n">cyclic_periodic</span><span class="p">):</span>
            <span class="n">ringcopy</span><span class="o">.</span><span class="n">remove_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

    <span class="c1"># find all non-cyclic bonds</span>
    <span class="c1"># single bonds between cycles, break and cap with H</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span><span class="o">.</span><span class="n">is_cyclic</span><span class="p">:</span>
            <span class="c1"># bonds between cycles</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="nb">all</span><span class="p">((</span><span class="n">member</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">))),</span>
                    <span class="p">(</span>
                        <span class="nb">all</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">cyclic_periodic_labels</span>
                                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="n">member1</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">member2</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Hcap1</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">member1</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
                <span class="n">Hcap2</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">member2</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
                <span class="n">Hcap1_id</span> <span class="o">=</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">Hcap1</span><span class="p">)</span>
                <span class="n">Hcap2_id</span> <span class="o">=</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">Hcap2</span><span class="p">)</span>
                <span class="n">ringcopy</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span><span class="p">,</span> <span class="n">Hcap1_id</span><span class="p">,</span> <span class="n">member2</span><span class="p">)</span>
                <span class="n">ringcopy</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span><span class="p">,</span> <span class="n">Hcap2_id</span><span class="p">,</span> <span class="n">member1</span><span class="p">)</span>
                <span class="n">ringcopy</span><span class="o">.</span><span class="n">remove_bond</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>

    <span class="c1"># cap off-cycle atoms</span>
    <span class="k">for</span> <span class="n">offatom</span> <span class="ow">in</span> <span class="n">offcycle_atoms</span> <span class="o">+</span> <span class="n">offcycle_periodic</span><span class="p">:</span>
        <span class="c1"># get the VBO for each off-cycle atom</span>
        <span class="c1"># (VBO with respect to cyclic atoms)</span>
        <span class="n">offVBO</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># quick check for delocalized systems in the ring</span>
        <span class="c1"># if there are any, get the delocalised bond orders</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">offatom</span><span class="o">.</span><span class="n">bonds</span><span class="p">):</span>
            <span class="n">offdVBO</span> <span class="o">=</span> <span class="n">delocalisedLBO</span><span class="p">(</span><span class="n">ringcopy</span><span class="p">)</span>
        <span class="c1"># add the non-delocalized bond orders</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">offatom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="c1"># only interested in bonds to cyclic atoms</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">batom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span> <span class="k">for</span> <span class="n">batom</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="c1"># Each bond contributes to Ligand Bond Order according to its type</span>
                <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Double&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Triple&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Quadruple&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="n">offdVBO</span><span class="p">[</span><span class="n">offatom</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span><span class="p">:</span>
                    <span class="n">offVBO</span> <span class="o">+=</span> <span class="mi">0</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;impossible Aromatic bond&quot;</span><span class="p">)</span>
        <span class="c1"># cap with appropriate element for VBO</span>
        <span class="k">if</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;H&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;O&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">offatom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span>
        <span class="k">elif</span> <span class="n">offVBO</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no, that&#39;s too many&quot;</span><span class="p">)</span>

    <span class="c1"># for each cyclic system, reassign bonds, kekulize, and get VBO</span>
    <span class="c1"># the bond and atom pruning we did above ensures that fused cycles</span>
    <span class="c1"># will be treated as a single system</span>
    <span class="c1"># while non-fused cycles that are connected via bonding are treated</span>
    <span class="c1"># as seperate systems</span>
    <span class="k">for</span> <span class="n">cyclesys</span> <span class="ow">in</span> <span class="n">ringcopy</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
        <span class="c1"># reassign bonds and kekulize</span>
        <span class="n">cyclesys</span><span class="o">.</span><span class="n">assign_bond_types</span><span class="p">()</span>
        <span class="n">cyclesys</span><span class="o">.</span><span class="n">kekulize</span><span class="p">()</span>

        <span class="c1"># porhpyrins and similar molecules are misassigned, we will code a hard fix</span>
        <span class="c1"># first identify and isolate the inner porphyrin(/like) atoms</span>
        <span class="c1"># (these atoms determine overall charge)</span>
        <span class="c1"># store these in a dictionary for later</span>
        <span class="n">joining_atoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">joining_rings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">subring_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">porphyrinatoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">porphyrin_to_correct</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># ring by ring</span>
        <span class="k">for</span> <span class="n">subring</span> <span class="ow">in</span> <span class="n">cyclesys</span><span class="o">.</span><span class="n">rings</span><span class="p">:</span>
            <span class="n">subring_labels</span><span class="p">[</span><span class="n">subring</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># get a list of all atom labels in each subring</span>
            <span class="k">for</span> <span class="n">sratom</span> <span class="ow">in</span> <span class="n">subring</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">subring_labels</span><span class="p">[</span><span class="n">subring</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sratom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="c1"># check atom by atom</span>
            <span class="k">for</span> <span class="n">sratom</span> <span class="ow">in</span> <span class="n">subring</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="c1"># check each atom neighbour</span>
                <span class="k">for</span> <span class="n">srneighbour</span> <span class="ow">in</span> <span class="n">sratom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
                    <span class="n">srn_label</span> <span class="o">=</span> <span class="n">srneighbour</span><span class="o">.</span><span class="n">label</span>
                    <span class="c1"># if the neighbour is not part of the current ring</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">srn_label</span> <span class="ow">in</span> <span class="n">subring_labels</span><span class="p">[</span><span class="n">subring</span><span class="p">]:</span>
                        <span class="c1"># if the nighbour IS a cyclic atom</span>
                        <span class="c1"># consider this a &quot;joining atom&quot;</span>
                        <span class="k">if</span> <span class="n">srn_label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">joining_atoms</span><span class="p">[</span><span class="n">srn_label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subring</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">joining_atoms</span><span class="p">[</span><span class="n">srn_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subring</span><span class="p">]</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">joining_rings</span><span class="p">[</span><span class="n">subring</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srn_label</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">joining_rings</span><span class="p">[</span><span class="n">subring</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">srn_label</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">jring</span> <span class="ow">in</span> <span class="n">joining_rings</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([(</span><span class="nb">len</span><span class="p">(</span><span class="n">jring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">),</span> <span class="p">(</span><span class="n">jring</span><span class="o">.</span><span class="n">is_fully_conjugated</span><span class="p">)]):</span>
                <span class="k">for</span> <span class="n">patom</span> <span class="ow">in</span> <span class="n">jring</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">plabel</span> <span class="o">=</span> <span class="n">patom</span><span class="o">.</span><span class="n">label</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">plabel</span> <span class="ow">in</span> <span class="n">joining_atoms</span><span class="p">:</span>
                        <span class="n">ncyclicbonds</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">pbond</span> <span class="ow">in</span> <span class="n">patom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pbond</span><span class="o">.</span><span class="n">is_cyclic</span><span class="p">:</span>
                                <span class="n">ncyclicbonds</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">ncyclicbonds</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">porphyrinatoms</span><span class="p">[</span><span class="n">jring</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patom</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">porphyrinatoms</span><span class="p">[</span><span class="n">jring</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">patom</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">porph</span> <span class="ow">in</span> <span class="n">porphyrinatoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">porphyrinatoms</span><span class="p">[</span><span class="n">porph</span><span class="p">]):</span>
                <span class="n">protonated</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">patom</span> <span class="ow">in</span> <span class="n">porphyrinatoms</span><span class="p">[</span><span class="n">porph</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">patom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">):</span>
                        <span class="n">protonated</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">protonated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">patom</span> <span class="ow">in</span> <span class="n">porphyrinatoms</span><span class="p">[</span><span class="n">porph</span><span class="p">]:</span>
                        <span class="n">porphyrin_to_correct</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patom</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="c1"># quick check for delocalized systems in the ring</span>
        <span class="c1"># if there are any, get the delocalised bond orders</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">cyclesys</span><span class="o">.</span><span class="n">bonds</span><span class="p">):</span>
            <span class="n">rdVBO</span> <span class="o">=</span> <span class="n">delocalisedLBO</span><span class="p">(</span><span class="n">cyclesys</span><span class="p">)</span>

        <span class="c1"># assign VBO for each on-cycle atom</span>
        <span class="k">for</span> <span class="n">ratom</span> <span class="ow">in</span> <span class="n">cyclesys</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="n">rVBO</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">ratom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">oncycle_labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ratom</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">porphyrin_to_correct</span><span class="p">:</span>
                    <span class="n">rVBO</span> <span class="o">-=</span> <span class="mf">0.5</span>
                <span class="k">for</span> <span class="n">rbond</span> <span class="ow">in</span> <span class="n">ratom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="c1"># Each bond contributes to Ligand Bond Order</span>
                    <span class="c1"># according to its type except periodic copies</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span><span class="n">rbond</span><span class="o">.</span><span class="n">is_cyclic</span><span class="p">),</span>
                            <span class="p">(</span>
                                <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
                                    <span class="p">(</span>
                                        <span class="n">mem</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">cyclic_periodic_labels</span>
                                        <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">rbond</span><span class="o">.</span><span class="n">atoms</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Double&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Triple&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="mi">3</span>
                        <span class="k">elif</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Quadruple&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="mi">4</span>
                        <span class="k">elif</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="n">rdVBO</span><span class="p">[</span><span class="n">ratom</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">rbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span><span class="p">:</span>
                            <span class="n">rVBO</span> <span class="o">+=</span> <span class="mi">0</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;impossible Aromatic bond&quot;</span><span class="p">)</span>

                <span class="c1"># the VBOs are currently associated to atom objects</span>
                <span class="c1"># in molecule objects that we have modified</span>
                <span class="c1"># we need these to be associated to atom objects in</span>
                <span class="c1"># the parent (unmodified) molecule object</span>
                <span class="k">for</span> <span class="n">matom</span> <span class="ow">in</span> <span class="n">unassigned</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">matom</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">ratom</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                        <span class="n">ringVBO</span><span class="p">[</span><span class="n">matom</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rVBO</span>
                        <span class="c1"># unassigned.remove(matom)</span>
    <span class="k">return</span> <span class="n">ringVBO</span></div>


<div class="viewcode-block" id="assign_VBS"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.assign_VBS">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">assign_VBS</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">rVBO</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">dVBO</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns a Valence-Bond-Sum (VBS) to an atom.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object.</span>
<span class="sd">        rVBO (dict[int, int]): dictionary with each atom&#39;s index in mole.atoms</span>
<span class="sd">                               as keys and VBO (valence bond order) as values.</span>
<span class="sd">        dVBO (dict[int, float]): dictionary with delocalized bond-possessing</span>
<span class="sd">                                 atom&#39;s index in mole.atoms as keys and their</span>
<span class="sd">                                 corresponding (delocalized-only) VBS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VBO (int): valence bond sum value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VBO</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">rVBO</span><span class="p">:</span>
        <span class="n">VBO</span> <span class="o">=</span> <span class="n">rVBO</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">batom</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">batom</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">0</span>
            <span class="c1"># Each bond contributes to Ligand Bond Order according to its type</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">:</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Double&quot;</span><span class="p">:</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Triple&quot;</span><span class="p">:</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Quadruple&quot;</span><span class="p">:</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">:</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="n">dVBO</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span><span class="p">:</span>
                <span class="c1"># necessary? aVBO not defined</span>
                <span class="c1"># VBO += aVBO[atom]</span>
                <span class="n">VBO</span> <span class="o">+=</span> <span class="n">dVBO</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">VBO</span></div>


<div class="viewcode-block" id="delocalisedLBO"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.delocalisedLBO">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">delocalisedLBO</span><span class="p">(</span><span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a dictionary of all atoms in the molecule with delocalized bonds</span>
<span class="sd">    and their (delocalized-only) valence bond sum (VBS).</span>

<span class="sd">    Args:</span>
<span class="sd">        molecule (ccdc.molecule.Molecule): Molecule object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        delocal_dict (dict[int, float]): dictionary with delocalized bond-possessing</span>
<span class="sd">                                        atom&#39;s index in mole.atoms as keys and their</span>
<span class="sd">                                        corresponding (delocalized-only) VBS.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">TerminusCounter</span><span class="p">(</span><span class="n">atomlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of termini in the input delocalized bond system.</span>

<span class="sd">        Args:</span>
<span class="sd">            atomlist (list[ccdc.molecule.Atom]): list of atoms in delocalised system.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NTerminus (int): number of termini in delocalized bond system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NTerminus</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">:</span>
                    <span class="n">connectivity</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">NTerminus</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">NTerminus</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delocal_crawl</span><span class="p">(</span><span class="n">atomlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively searches for atoms in delocalised bond systems starting from</span>
<span class="sd">        an input list containing at least one delocalised bonding atom.</span>

<span class="sd">        Args:</span>
<span class="sd">            atomlist (list[ccdc.molecule.Atom)]: list of atoms in delocalised system.</span>

<span class="sd">        Returns:</span>
<span class="sd">            atomlist (list[ccdc.molecule.Atom]): modified list of atoms in</span>
<span class="sd">                                                 delocalised system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">delocatom</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">delocatom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
                            <span class="n">atomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">delocal_crawl</span><span class="p">(</span><span class="n">atomlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atomlist</span>

    <span class="n">delocal_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">bonds</span><span class="p">)),</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">delocal_dict</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="n">delocal_dict</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">delocal_system</span> <span class="o">=</span> <span class="n">delocal_crawl</span><span class="p">([</span><span class="n">atom</span><span class="p">])</span>
            <span class="n">NTerminus</span> <span class="o">=</span> <span class="n">TerminusCounter</span><span class="p">(</span><span class="n">delocal_system</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">datom</span> <span class="ow">in</span> <span class="n">delocal_system</span><span class="p">:</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">delocLBO</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">datom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">delocal_system</span><span class="p">:</span>
                        <span class="n">connectivity</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">connectivity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># terminus</span>
                    <span class="n">delocLBO</span> <span class="o">=</span> <span class="p">(</span><span class="n">NTerminus</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">NTerminus</span>
                <span class="k">if</span> <span class="n">connectivity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># node</span>
                    <span class="n">delocLBO</span> <span class="o">=</span> <span class="p">(</span><span class="n">connectivity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">connectivity</span>
                <span class="n">delocal_dict</span><span class="p">[</span><span class="n">datom</span><span class="p">]</span> <span class="o">=</span> <span class="n">delocLBO</span>
    <span class="k">return</span> <span class="n">delocal_dict</span></div>


<div class="viewcode-block" id="iVBS_FormalCharge"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.iVBS_FormalCharge">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">iVBS_FormalCharge</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the formal charge of an atom NOT involved in any aromatic or</span>
<span class="sd">    delocalized bonding system.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object</span>

<span class="sd">    Returns:</span>
<span class="sd">        charge (int): formal charge of the input atom.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VBO</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">VBO</span>
    <span class="n">CN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">CN</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">valence</span> <span class="o">=</span> <span class="n">valence_e</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">batom</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">batom</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">0</span>
        <span class="c1"># Each bond contributes to Ligand Bond Order according to its type</span>
        <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">:</span>
            <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Double&quot;</span><span class="p">:</span>
            <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Triple&quot;</span><span class="p">:</span>
            <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Quadruple&quot;</span><span class="p">:</span>
            <span class="n">VBO</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="c1"># need the unpaired electrons</span>
    <span class="n">unpaired_e</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">valence</span><span class="p">)</span>
    <span class="c1"># expanded valences require special handling</span>
    <span class="k">if</span> <span class="n">VBO</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">unpaired_e</span><span class="p">):</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">VBO</span> <span class="o">-</span> <span class="n">unpaired_e</span>
    <span class="c1"># Expanded (2e) valences:</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">VBO</span> <span class="o">&gt;</span> <span class="n">unpaired_e</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">VBO</span> <span class="o">&lt;</span> <span class="n">valence</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">VBO</span> <span class="o">-</span> <span class="n">unpaired_e</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">6</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">8</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="p">(</span><span class="n">VBO</span> <span class="o">+</span> <span class="n">UPE</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">VBO</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">valence</span><span class="p">):</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">VBO</span>
    <span class="k">return</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="get_CN"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_CN">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_CN</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the coordination number of the input atom.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        coord_number (int): Atom&#39;s coordination number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">CN</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">CN</span></div>


<div class="viewcode-block" id="valence_e"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.valence_e">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">valence_e</span><span class="p">(</span><span class="n">elmnt</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the number of valence electrons of an atom/element.</span>

<span class="sd">    Args:</span>
<span class="sd">        elmnt (ccdc.molecule.Atom): Atom object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        valence (int): Atom&#39;s valence electron count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="n">mendeleev</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="n">elmnt</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">block</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">group_id</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">block</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">group_id</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">block</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">group_id</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">block</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">72</span><span class="p">):</span>
            <span class="n">valence</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">-</span> <span class="mi">57</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="mi">104</span><span class="p">):</span>
            <span class="n">valence</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">-</span> <span class="mi">89</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;He&quot;</span><span class="p">:</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">valence</span></div>


<div class="viewcode-block" id="carbocation_check"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.carbocation_check">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">carbocation_check</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;tetrahedral&quot;</span><span class="p">,</span> <span class="s2">&quot;trigonal&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check carbocation/carbanion geometry according to bond angles.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Literal[&quot;tetrahedral&quot;, &quot;trigonal&quot;]: geometry at input atom.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># get atom neighbours</span>
    <span class="k">for</span> <span class="n">neighbours</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbours</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">abc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbours</span><span class="p">)</span>
    <span class="c1"># get all three relevant bond angles</span>
    <span class="n">angle1</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">MolecularDescriptors</span><span class="o">.</span><span class="n">atom_angle</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="p">,</span> <span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">angle2</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">MolecularDescriptors</span><span class="o">.</span><span class="n">atom_angle</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="p">,</span> <span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">angle3</span> <span class="o">=</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">MolecularDescriptors</span><span class="o">.</span><span class="n">atom_angle</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom</span><span class="p">,</span> <span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># average the angels</span>
    <span class="n">AVGangle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle1</span> <span class="o">+</span> <span class="n">angle2</span> <span class="o">+</span> <span class="n">angle3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="c1"># take the difference between the averaged bond angles and</span>
    <span class="c1"># ideal trigonal planar/tetrahedral bond angles</span>
    <span class="n">tet</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">AVGangle</span> <span class="o">-</span> <span class="mf">109.5</span><span class="p">)</span>
    <span class="n">trig</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">AVGangle</span> <span class="o">-</span> <span class="mi">120</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tet</span> <span class="o">&lt;</span> <span class="n">trig</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;tetrahedral&quot;</span>
    <span class="k">if</span> <span class="n">trig</span> <span class="o">&lt;</span> <span class="n">tet</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;trigonal&quot;</span></div>


<div class="viewcode-block" id="carbene_type"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.carbene_type">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">carbene_type</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;singlet&quot;</span><span class="p">,</span> <span class="s2">&quot;triplet&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Distinguishes between singlet and triplet carbenes.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object(s) suspected of belonging to a</span>
<span class="sd">                                   carbene (2-coordinate carbon II).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Literal[&quot;singlet&quot;, &quot;triplet&quot;]: carbene type at input atom.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get alpha-atoms</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span>
    <span class="n">alpha_type</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># get element symbols for alpha atoms</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">alpha_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">)</span>
    <span class="c1"># if any alpha atom is a heteroatom, return &quot;singlet&quot;</span>
    <span class="c1"># these are Fischer carbenes</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alpha_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([(</span><span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">)]):</span>
            <span class="k">return</span> <span class="s2">&quot;singlet&quot;</span>
    <span class="c1"># if the carbene C is in a heterocycle,</span>
    <span class="c1"># return &quot;singlet&quot;</span>
    <span class="c1"># there are Arduengo carbenes (NHCs, CAACs)</span>
    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_cyclic</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">rings</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">ring</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">species</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;singlet&quot;</span>
    <span class="c1"># for all other carbenes, return &quot;triplet&quot;</span>
    <span class="c1"># these are Schrock carbenes</span>
    <span class="k">return</span> <span class="s2">&quot;triplet&quot;</span></div>


<div class="viewcode-block" id="hapticity"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.hapticity">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">hapticity</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">metalsite</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if a ligand binding site possesses hapticity (any n-hapto).</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): Atom object.</span>
<span class="sd">        metalsites (list[ccdc.molecule.Atom]): list of metal sites in the structure</span>
<span class="sd">                                               that belong to the asymmetric unit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: whether the the input ligand is hapto-.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">atom2</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">atom2</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">n2</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">metalsite</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">atom2</span><span class="o">.</span><span class="n">neighbours</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="bridging"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.bridging">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">bridging</span><span class="p">(</span><span class="n">atom</span><span class="p">:</span> <span class="n">Atom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines how many metal atoms the input atom binds to search for</span>
<span class="sd">    bridging sites.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom (ccdc.molecule.Atom): binding site Atom object.</span>

<span class="sd">    Returns:</span>
<span class="sd">       bridge (int): number of metal atoms bound to the atom.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bridge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">bridge</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">bridge</span></div>


<div class="viewcode-block" id="iVBS_Oxidation_Contrib"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.iVBS_Oxidation_Contrib">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">iVBS_Oxidation_Contrib</span><span class="p">(</span>
    <span class="n">unique_atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">rVBO</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">dVBO</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the oxidation state contribution of all unique atoms.</span>

<span class="sd">    Args:</span>
<span class="sd">        unique_atoms (list[ccdc.molecule.Atom]): unique atoms belonging to the</span>
<span class="sd">                                                 asymmetric unit.</span>
<span class="sd">        rVBO (dict[int, int]): dictionary with each atom&#39;s index in mole.atoms</span>
<span class="sd">                               as keys and VBO (valence bond order) as values.</span>
<span class="sd">        dVBO (dict[int, float]): dictionary with delocalized bond-possessing atom&#39;s</span>
<span class="sd">                                index in mole.atoms as keys and their corresponding</span>
<span class="sd">                                (delocalized-only) VBS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        oxi_contrib (dict[ccdc.molecule.Atom, float)]: dictionary with Atom object</span>
<span class="sd">                         as keys and their oxidation state contribution as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VBS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">valence</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">oxi_contrib</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># for each unique atom</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">unique_atoms</span><span class="p">:</span>
        <span class="c1"># assign valence-bond-sum</span>
        <span class="n">VBS</span> <span class="o">=</span> <span class="n">assign_VBS</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">rVBO</span><span class="p">,</span> <span class="n">dVBO</span><span class="p">)</span>
        <span class="c1"># determine coordination number</span>
        <span class="n">CN</span> <span class="o">=</span> <span class="n">get_CN</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="c1">#  determine number of valence electrons</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="n">valence_e</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="c1"># get number of unpaired electrons in the free element</span>
        <span class="n">unpaired_e</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">valence</span><span class="p">)</span>

        <span class="c1">#  metals do not contribute:</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
            <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Normal valences:</span>
        <span class="k">elif</span> <span class="n">VBS</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">unpaired_e</span><span class="p">):</span>
            <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="n">VBS</span>
        <span class="c1"># Expanded (2e) valences:</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">VBS</span> <span class="o">&gt;</span> <span class="n">unpaired_e</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">VBS</span> <span class="o">&lt;</span> <span class="n">valence</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">VBS</span> <span class="o">-</span> <span class="n">unpaired_e</span>
            <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">6</span>
            <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">UPE</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="n">unpaired_e</span> <span class="o">-</span> <span class="mi">8</span>
            <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">VBS</span> <span class="o">+</span> <span class="n">UPE</span> <span class="o">-</span> <span class="n">valence</span>
        <span class="k">elif</span> <span class="n">VBS</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">valence</span><span class="p">):</span>
            <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">VBS</span> <span class="o">-</span> <span class="n">valence</span>

        <span class="c1"># need to check for 3-coordinate carbocations,</span>
        <span class="c1"># 3-coordinate carbanions, carbenes, and heavier</span>
        <span class="c1"># homologues (these are not immediately detectable)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;Si&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;Ge&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;Pb&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">rVBO</span><span class="p">:</span>
                <span class="c1"># 3 coordinate and VBS 3 could be</span>
                <span class="c1"># carbanion or carbocation</span>
                <span class="k">if</span> <span class="n">VBS</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">CN</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">geom</span> <span class="o">=</span> <span class="n">carbocation_check</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">geom</span> <span class="o">==</span> <span class="s2">&quot;trigonal&quot;</span><span class="p">:</span>
                        <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">geom</span> <span class="o">==</span> <span class="s2">&quot;tetrahedral&quot;</span><span class="p">:</span>
                        <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># VBS 2 and 2 coordinate is carbene,</span>
            <span class="c1"># but singlet or triplet?</span>
            <span class="k">if</span> <span class="n">VBS</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">CN</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">carbene</span> <span class="o">=</span> <span class="n">carbene_type</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">carbene</span> <span class="o">==</span> <span class="s2">&quot;singlet&quot;</span><span class="p">:</span>
                    <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">carbene</span> <span class="o">==</span> <span class="s2">&quot;triplet&quot;</span><span class="p">:</span>
                    <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># Nitro groups frequently have both N-O bonds assigned</span>
        <span class="c1"># as double bonds, giving incorrect VBS of 5</span>
        <span class="c1"># and oxidation contribution of -2</span>
        <span class="c1"># this block catches this and applies a fix</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">VBS</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">CN</span> <span class="o">==</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="n">N_sphere1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span>
            <span class="n">O_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">N_sphere1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
                    <span class="n">O_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">carbocation_check</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">O_count</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">geom</span> <span class="o">==</span> <span class="s2">&quot;trigonal&quot;</span><span class="p">:</span>
                <span class="n">oxi_contrib</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">oxi_contrib</span></div>


<div class="viewcode-block" id="redundantAON"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.redundantAON">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">redundantAON</span><span class="p">(</span><span class="n">AON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the oxidation contributions of unique atom sites to the redundant atom</span>
<span class="sd">    sites according to their shared atom labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        AON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their oxidation state contribution as values for unique</span>
<span class="sd">                        Atom objects.</span>
<span class="sd">        molecule (ccdc.molecule.Molecule): Molecule object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        redAON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their oxidation state contribution as values for all</span>
<span class="sd">                        (including redundant) Atom objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redAON</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">rsite1</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">usite1</span> <span class="ow">in</span> <span class="n">AON</span><span class="p">:</span>
            <span class="n">redAON</span><span class="p">[</span><span class="n">usite1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AON</span><span class="p">[</span><span class="n">usite1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rsite1</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">usite1</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                <span class="n">redAON</span><span class="p">[</span><span class="n">rsite1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AON</span><span class="p">[</span><span class="n">usite1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">redAON</span></div>


<div class="viewcode-block" id="binding_domain"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.binding_domain">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">binding_domain</span><span class="p">(</span>
    <span class="n">binding_sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
    <span class="n">AON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span>
    <span class="n">usites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds bonding domains within the crystal structure to determine which</span>
<span class="sd">    metal binding sites (Atom objects directly bonded to a metal) are connected</span>
<span class="sd">    via conjugation. Function accounts for the inconsistent assignment of</span>
<span class="sd">    delocalized bonds, by using the bonding domains (see methodology section</span>
<span class="sd">    for details on the implementation and validation).</span>

<span class="sd">    Args:</span>
<span class="sd">        binding_sites (list[ccdc.molecule.Atom]): list of binding sites connecting</span>
<span class="sd">                                                  metal atoms and ligands.</span>
<span class="sd">        AON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their oxidation state contribution as values for unique</span>
<span class="sd">                        Atom objects.</span>
<span class="sd">        molecule (ccdc.molecule.Molecule): Molecule object.</span>
<span class="sd">        uniquesites (list[ccdc.molecule.Atom]): list of unique atoms.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sitedomain (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                        dictionary with Atom object as keys and a list of Atoms</span>
<span class="sd">                        connected through bonding that form a binding domain</span>
<span class="sd">                        as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">arom_domains</span><span class="p">(</span>
        <span class="n">site</span><span class="p">:</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">usites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">aromlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">bondset</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Bond</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively generate aromatic binding domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="n">bondset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bondset</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">(</span><span class="ow">not</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">aromlist</span><span class="p">),</span>
                        <span class="p">(</span><span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">is_metal</span><span class="p">),</span>
                        <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">mbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span> <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">aromlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                        <span class="n">bondset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mbond</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">arom_domains</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">usites</span><span class="p">,</span> <span class="n">aromlist</span><span class="p">,</span> <span class="n">bondset</span><span class="p">)</span>
        <span class="c1"># aromlist currently contains non-unique instances of atoms</span>
        <span class="c1"># this will cause problems further down the line, so correct</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aromlist</span><span class="p">):</span>
            <span class="n">aromlist</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">usites</span><span class="p">[</span><span class="n">member</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">aromlist</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deloc_domains</span><span class="p">(</span>
        <span class="n">site</span><span class="p">:</span> <span class="n">Atom</span><span class="p">,</span>
        <span class="n">usites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
        <span class="n">AON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span>
        <span class="n">deloclist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
        <span class="n">bondset</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Bond</span><span class="p">],</span>
        <span class="n">checked_bonds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Bond</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively generate delocalised binding domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bondset</span><span class="p">:</span>
                <span class="n">bondset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bondset</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">checked_bonds</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span><span class="ow">not</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">deloclist</span><span class="p">),</span>
                            <span class="p">(</span><span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">is_metal</span><span class="p">),</span>
                            <span class="p">(</span>
                                <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                    <span class="n">mbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span>
                                    <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span>
                                <span class="p">)</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="nb">any</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="p">(</span>
                                            <span class="nb">len</span><span class="p">(</span>
                                                <span class="n">molecule</span><span class="o">.</span><span class="n">shortest_path_bonds</span><span class="p">(</span>
                                                    <span class="n">site</span><span class="p">,</span> <span class="n">member</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                                            <span class="o">&lt;=</span> <span class="mi">2</span>
                                        <span class="p">),</span>
                                        <span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">is_conjugated</span><span class="p">),</span>
                                        <span class="p">(</span>
                                            <span class="nb">all</span><span class="p">(</span>
                                                <span class="p">[</span>
                                                    <span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="ow">not</span> <span class="n">AON</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                                                <span class="p">]</span>
                                            <span class="p">)</span>
                                        <span class="p">),</span>
                                        <span class="p">(</span>
                                            <span class="nb">all</span><span class="p">(</span>
                                                <span class="p">[</span>
                                                    <span class="p">(</span>
                                                        <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                                            <span class="n">mbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span>
                                                            <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span>
                                                        <span class="p">)</span>
                                                    <span class="p">),</span>
                                                    <span class="p">(</span>
                                                        <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                                            <span class="n">mbond</span><span class="o">.</span><span class="n">bond_type</span>
                                                            <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span>
                                                            <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span>
                                                        <span class="p">)</span>
                                                    <span class="p">),</span>
                                                    <span class="p">(</span>
                                                        <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                                            <span class="n">mbond</span><span class="o">.</span><span class="n">bond_type</span>
                                                            <span class="o">==</span> <span class="s2">&quot;Delocalised&quot;</span>
                                                            <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span>
                                                        <span class="p">)</span>
                                                    <span class="p">),</span>
                                                <span class="p">]</span>
                                            <span class="p">)</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">deloclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">mbond</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                            <span class="n">bondset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mbond</span><span class="p">)</span>
                <span class="n">checked_bonds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">deloc_domains</span><span class="p">(</span>
                    <span class="n">site</span><span class="p">,</span> <span class="n">usites</span><span class="p">,</span> <span class="n">AON</span><span class="p">,</span> <span class="n">molecule</span><span class="p">,</span> <span class="n">deloclist</span><span class="p">,</span> <span class="n">bondset</span><span class="p">,</span> <span class="n">checked_bonds</span>
                <span class="p">)</span>
        <span class="c1"># deloclist currently contains non-unique instances of atoms</span>
        <span class="c1"># this will cause problems further down the line, so correct</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deloclist</span><span class="p">):</span>
            <span class="n">deloclist</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">usites</span><span class="p">[</span><span class="n">member</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">deloclist</span>

    <span class="n">sitedomain</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">binding_sites</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">site</span><span class="o">.</span><span class="n">is_metal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">sbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span> <span class="k">for</span> <span class="n">sbond</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">bonds</span><span class="p">):</span>
                <span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="n">arom_domains</span><span class="p">(</span>
                    <span class="n">site</span><span class="p">,</span> <span class="n">usites</span><span class="p">,</span> <span class="n">aromlist</span><span class="o">=</span><span class="p">[</span><span class="n">site</span><span class="p">],</span> <span class="n">bondset</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">sbond</span><span class="o">.</span><span class="n">bond_type</span> <span class="o">==</span> <span class="s2">&quot;Aromatic&quot;</span> <span class="k">for</span> <span class="n">sbond</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">bonds</span><span class="p">):</span>
                <span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="n">deloc_domains</span><span class="p">(</span>
                    <span class="n">site</span><span class="p">,</span>
                    <span class="n">usites</span><span class="p">,</span>
                    <span class="n">AON</span><span class="p">,</span>
                    <span class="n">molecule</span><span class="p">,</span>
                    <span class="n">deloclist</span><span class="o">=</span><span class="p">[</span><span class="n">site</span><span class="p">],</span>
                    <span class="n">bondset</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
                    <span class="n">checked_bonds</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
                <span class="p">)</span>

    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sitedomain</span><span class="p">:</span>
        <span class="n">olapset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">site2</span> <span class="ow">in</span> <span class="n">sitedomain</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">sitedomain</span><span class="p">[</span><span class="n">site2</span><span class="p">]:</span>
                    <span class="n">olapset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">site2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">olap</span> <span class="ow">in</span> <span class="n">olapset</span><span class="p">:</span>
            <span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">sitedomain</span><span class="p">[</span><span class="n">olap</span><span class="p">]))</span>
            <span class="n">sitedomain</span><span class="p">[</span><span class="n">olap</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitedomain</span><span class="p">[</span><span class="n">site</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sitedomain</span></div>


<div class="viewcode-block" id="binding_contrib"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.binding_contrib">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">binding_contrib</span><span class="p">(</span>
    <span class="n">binding_sphere</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
    <span class="n">binding_sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
    <span class="n">AON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redistributes oxidation state contributions within a binding domain.</span>
<span class="sd">    Equal distribution is assumed across connected binding sites in each domain.</span>

<span class="sd">    Args:</span>
<span class="sd">        binding_sphere (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                        dictionary with Atom object as keys and a list of Atoms</span>
<span class="sd">                        connected through bonding that form a binding domain as values.</span>
<span class="sd">        binding_sites (list[ccdc.molecule.Atom]): list of binding sites connecting</span>
<span class="sd">                                                  metal atoms and ligands.</span>
<span class="sd">        AON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their oxidation state contribution as values for unique Atoms.</span>

<span class="sd">    Returns:</span>
<span class="sd">        site_contrib (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their updated oxidation state contribution as values accounting</span>
<span class="sd">                        for distribution within the binding domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">site_contrib</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">binding_sphere</span><span class="p">:</span>
        <span class="n">site_contrib</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nbinding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">binding_sphere</span><span class="p">[</span><span class="n">site</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">binding_sites</span><span class="p">:</span>
                <span class="n">nbinding</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">site_contrib</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">+=</span> <span class="n">AON</span><span class="p">[</span><span class="n">member</span><span class="p">]</span>
        <span class="n">site_contrib</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nbinding</span>
    <span class="k">return</span> <span class="n">site_contrib</span></div>


<div class="viewcode-block" id="outer_sphere_domain"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.outer_sphere_domain">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">outer_sphere_domain</span><span class="p">(</span>
    <span class="n">uniquesites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">binding_domains</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identifies sites outside of the binding domains which must be checked for</span>
<span class="sd">    outer sphere charge contributions.</span>

<span class="sd">    Args:</span>
<span class="sd">        uniquesites (list[ccdc.molecule.Atom]): list of unique atoms in the structure</span>
<span class="sd">                                                belonging to the asymmetric unit.</span>
<span class="sd">        binding_domains (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                        dictionary with Atom object as keys and a list of Atoms</span>
<span class="sd">                        connected through bonding that form a binding domain as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        outer_sphere (list[ccdc.molecule.Atom]): list of unique, non-metal atoms</span>
<span class="sd">                                                 outside of binding domains.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outer_sphere</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">uniquesites</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">site</span> <span class="ow">in</span> <span class="n">binding_domains</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">binding_domains</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">site</span><span class="o">.</span><span class="n">is_metal</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="n">outer_sphere</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outer_sphere</span></div>


<div class="viewcode-block" id="outer_sphere_contrib"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.outer_sphere_contrib">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">outer_sphere_contrib</span><span class="p">(</span><span class="n">outer_sphere</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span> <span class="n">AON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the total oxidation state contribution of the outer sphere atoms as</span>
<span class="sd">    the sum of their formal charge/contributions.</span>

<span class="sd">    Args:</span>
<span class="sd">        outer_sphere (list[ccdc.molecule.Atom]): list of unique, non-metal atoms</span>
<span class="sd">                                                 outside of binding domains.</span>
<span class="sd">        AON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as keys</span>
<span class="sd">                        and their oxidation state contribution as values for unique Atoms.</span>

<span class="sd">    Returns:</span>
<span class="sd">        contrib (int): sum of outer sphere charge contributions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contrib</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">outer_sphere</span><span class="p">:</span>
        <span class="n">contrib</span> <span class="o">+=</span> <span class="n">AON</span><span class="p">[</span><span class="n">site</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">contrib</span></div>


<div class="viewcode-block" id="get_metal_networks"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.get_metal_networks">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_metal_networks</span><span class="p">(</span>
    <span class="n">ligand_sites</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
    <span class="n">binding_sphere</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
    <span class="n">bindingAON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the metal atoms that are connected through binding domains and</span>
<span class="sd">    charged ligands. Any connections through neutral ligands are ignored as they</span>
<span class="sd">    do not contribute to the charge accounting.</span>

<span class="sd">    Args:</span>
<span class="sd">        ligand_sites (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                            dictionary with metal Atom object as key and the</span>
<span class="sd">                            list of ligand atoms which bind them as values.</span>
<span class="sd">        binding_sphere (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                            dictionary with Atom object as keys and a list of Atoms</span>
<span class="sd">                            connected through bonding that form a binding domain</span>
<span class="sd">                            as values.</span>
<span class="sd">        bindingAON (dict[ccdc.molecule.Atom, float]): dictionary with Atom object as</span>
<span class="sd">                            keys and their updated oxidation state contribution as</span>
<span class="sd">                            values accounting for distribution within the binding domain.</span>

<span class="sd">    Returns:</span>
<span class="sd">        network_dict (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                            dictionary with as metal Atom objects as keys and a list</span>
<span class="sd">                            of other metal Atom objects connected through binding</span>
<span class="sd">                            domains/charged ligands as values. Ignores neutral ligand</span>
<span class="sd">                            connections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">network_crawl</span><span class="p">(</span>
        <span class="n">ligand_sites</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
        <span class="n">binding_sphere</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
        <span class="n">bindingAON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">metal_networks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
        <span class="n">checked_sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
        <span class="n">group</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively crawl through bonds to identify metals connected through direct bondings</span>
<span class="sd">        or delocalised/conjugated systems.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="c1"># This block will find all metals connected to an input metal by metal-metal bonds</span>
            <span class="n">checked_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">metal</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">checked_sites</span><span class="p">:</span>
                        <span class="n">checked_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbour</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">site</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                                    <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">network_crawl</span><span class="p">(</span>
                            <span class="n">ligand_sites</span><span class="p">,</span>
                            <span class="n">binding_sphere</span><span class="p">,</span>
                            <span class="n">bindingAON</span><span class="p">,</span>
                            <span class="n">metal_networks</span><span class="p">,</span>
                            <span class="n">checked_sites</span><span class="p">,</span>
                            <span class="n">group</span><span class="p">,</span>
                        <span class="p">)</span>
            <span class="c1"># this block will find all metals connected to an input metal by</span>
            <span class="c1"># conjugation and delocalized charge ligands</span>
            <span class="c1"># metals connected through NEUTRAL ligands will be ignored</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">[</span><span class="n">metal</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([(</span><span class="ow">not</span> <span class="n">bindingAON</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="ow">not</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">checked_sites</span><span class="p">)]):</span>
                    <span class="k">for</span> <span class="n">dsite</span> <span class="ow">in</span> <span class="n">binding_sphere</span><span class="p">[</span><span class="n">site</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                            <span class="p">[(</span><span class="ow">not</span> <span class="n">dsite</span> <span class="ow">in</span> <span class="n">checked_sites</span><span class="p">),</span> <span class="p">(</span><span class="n">dsite</span> <span class="ow">in</span> <span class="n">binding_sphere</span><span class="p">)]</span>
                        <span class="p">):</span>
                            <span class="n">checked_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dsite</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">environ</span> <span class="ow">in</span> <span class="n">dsite</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">environ</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">environ</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                                            <span class="p">[</span>
                                                <span class="p">(</span>
                                                    <span class="nb">all</span><span class="p">(</span>
                                                        <span class="ow">not</span> <span class="n">environ</span> <span class="ow">in</span> <span class="n">network</span>
                                                        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">metal_networks</span>
                                                    <span class="p">)</span>
                                                <span class="p">),</span>
                                                <span class="p">(</span><span class="ow">not</span> <span class="n">environ</span> <span class="ow">in</span> <span class="n">group</span><span class="p">),</span>
                                            <span class="p">]</span>
                                        <span class="p">):</span>
                                            <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">for</span> <span class="n">umetal</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                                                <span class="p">[</span>
                                                    <span class="p">(</span><span class="n">umetal</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">environ</span><span class="o">.</span><span class="n">label</span><span class="p">),</span>
                                                    <span class="p">(</span>
                                                        <span class="nb">all</span><span class="p">(</span>
                                                            <span class="ow">not</span> <span class="n">umetal</span> <span class="ow">in</span> <span class="n">network</span>
                                                            <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">metal_networks</span>
                                                        <span class="p">)</span>
                                                    <span class="p">),</span>
                                                    <span class="p">(</span><span class="ow">not</span> <span class="n">umetal</span> <span class="ow">in</span> <span class="n">group</span><span class="p">),</span>
                                                <span class="p">]</span>
                                            <span class="p">):</span>
                                                <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">umetal</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">network_crawl</span><span class="p">(</span>
                        <span class="n">ligand_sites</span><span class="p">,</span>
                        <span class="n">binding_sphere</span><span class="p">,</span>
                        <span class="n">bindingAON</span><span class="p">,</span>
                        <span class="n">metal_networks</span><span class="p">,</span>
                        <span class="n">checked_sites</span><span class="p">,</span>
                        <span class="n">group</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>

    <span class="n">metal_networks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">network</span> <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">):</span>
            <span class="n">metal_networks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">network_crawl</span><span class="p">(</span>
                    <span class="n">ligand_sites</span><span class="p">,</span>
                    <span class="n">binding_sphere</span><span class="p">,</span>
                    <span class="n">bindingAON</span><span class="p">,</span>
                    <span class="n">metal_networks</span><span class="p">,</span>
                    <span class="n">checked_sites</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">group</span><span class="o">=</span><span class="p">[</span><span class="n">metal</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">network_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">network</span><span class="p">:</span>
            <span class="n">network_dict</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="n">network</span>
    <span class="k">return</span> <span class="n">network_dict</span></div>


<div class="viewcode-block" id="distribute_ONEC"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.distribute_ONEC">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">distribute_ONEC</span><span class="p">(</span>
    <span class="n">sONEC</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">metal_networks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
    <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">metal_CN</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Molecule</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">most_probable_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redistributes the oxidation state contributions across all metal atoms in</span>
<span class="sd">    the structure according to their metal networks (fully local distribution)</span>
<span class="sd">    &amp; calculates their associated electron counts. Features utilizing electron</span>
<span class="sd">    counts are minimally implemented at this time.</span>

<span class="sd">    Args:</span>
<span class="sd">        sONEC (dict[ccdc.molecule.Atom, list[float, float]]): dictionary with</span>
<span class="sd">                        metal Atom object as keys and lists containing the initial</span>
<span class="sd">                        oxidation state and electron count implied by only the</span>
<span class="sd">                        equal splitting of binding domain charges as values.</span>
<span class="sd">        metal_networks (dict[ccdc.molecule.Atom, list[ccdc.molecule.Atom]]):</span>
<span class="sd">                        dictionary with as metal Atom objects as keys and a list of</span>
<span class="sd">                        other metal Atom objects connected through binding domains/</span>
<span class="sd">                        charged ligands as values. Ignores neutral ligand connections.</span>
<span class="sd">        IEs (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of their reported ionization energies as values.</span>
<span class="sd">        ONP (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of the probability at the relevant oxidation states</span>
<span class="sd">                        as values.</span>
<span class="sd">        highest_known_ON (dict[str, int]) : dictionary with metal element symbols as</span>
<span class="sd">                        keys and a their highest known oxidation state as values.</span>
<span class="sd">        metal_CN (dict[ccdc.molecule.Molecule, int]): dictionary with as metal Atom</span>
<span class="sd">                        objects as keys and their effective coordination number as values.</span>
<span class="sd">        most_probable_ON (dict[str, int]) : dictionary with metal element symbols as</span>
<span class="sd">                        keys and a their oxidation state with the highest probability</span>
<span class="sd">                        as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        distributed_ONEC (dict[ccdc.molecule.Atom, list[float, float]]): dictionary</span>
<span class="sd">                        with metal Atom object as keys and lists containing their</span>
<span class="sd">                        redistributed oxidation state and electron count as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recursive_distributor_single_network</span><span class="p">(</span>
        <span class="n">iONEC</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">available_charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sorted_metals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Atom</span><span class="p">],</span>
        <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distribute network charge according to ionization energy and probability</span>
<span class="sd">        until all charge is distributed. Performed after tallying available</span>
<span class="sd">        network charge and sorting network metals by element type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initialize working dictionary</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iONEC</span><span class="p">)</span>

        <span class="c1"># positive contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># get list of improbable and improbable next oxidations</span>
            <span class="n">prob_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span>
                        <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>

            <span class="c1"># if only one metal type has a probable next oxidation state, do that</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">prob_metal_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if more than one metal type has a probable next oxidation state,</span>
            <span class="c1"># determine next lowest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># find lowest next ionization energy</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">prob_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># if there is no probable next oxidation state available,</span>
            <span class="c1"># determine lowest ionization energy among improbable next oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># find lowest next ionization energy</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">improb_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># negative contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get list of improbable and improbable next oxidations</span>
            <span class="n">prob_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span>
                        <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>

            <span class="c1"># if only one metal type has a probable next oxidation state, do that</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">prob_metal_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if more than one metal type has a probable next oxidation state,</span>
            <span class="c1"># determine next highest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">prob_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># if no probable next oxidation states are available,</span>
            <span class="c1"># determine next highest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">improb_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">improb_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># if all charge has been distributed, we&#39;re done, otherwise, roll again</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dONEC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recursive_distributor_single_network</span><span class="p">(</span>
                <span class="n">dONEC</span><span class="p">,</span> <span class="n">available_charge</span><span class="p">,</span> <span class="n">sorted_metals</span><span class="p">,</span> <span class="n">IEs</span><span class="p">,</span> <span class="n">ONP</span><span class="p">,</span> <span class="n">highest_known_ON</span>
            <span class="p">)</span>

    <span class="c1"># operate on each network individually</span>
    <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">:</span>

        <span class="c1"># sort metals by element type</span>
        <span class="n">sorted_metals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">[</span><span class="n">network</span><span class="p">]:</span>
            <span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">[</span><span class="n">network</span><span class="p">]:</span>
            <span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>

        <span class="c1"># tally up network charge to be distributed</span>
        <span class="c1"># and initialize metals to most probable ON</span>
        <span class="c1"># (adjust network charge accordingly)</span>
        <span class="n">network_charge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">[</span><span class="n">network</span><span class="p">]:</span>
            <span class="n">network_charge</span> <span class="o">+=</span> <span class="n">sONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">most_probable_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]]</span>
            <span class="n">network_charge</span> <span class="o">-=</span> <span class="n">most_probable_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span>
            <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># if the most probable oxidation distribution has already balanced the charge, we&#39;re done</span>
        <span class="c1"># if not, recursively distribute network charge according to ionization energy</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">network_charge</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)):</span>
            <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="n">recursive_distributor_single_network</span><span class="p">(</span>
                <span class="n">distributed_ONEC</span><span class="p">,</span>
                <span class="n">network_charge</span><span class="p">,</span>
                <span class="n">sorted_metals</span><span class="p">,</span>
                <span class="n">IEs</span><span class="p">,</span>
                <span class="n">ONP</span><span class="p">,</span>
                <span class="n">highest_known_ON</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># finally, adjust electron count to new oxidation state (OiL RiG)</span>
        <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metal_networks</span><span class="p">[</span><span class="n">network</span><span class="p">]:</span>
            <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">valence_e</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">metal_CN</span><span class="p">[</span><span class="n">metal</span><span class="p">])</span> <span class="o">-</span> <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">distributed_ONEC</span></div>


<div class="viewcode-block" id="distribute_OuterSphere"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.distribute_OuterSphere">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">distribute_OuterSphere</span><span class="p">(</span>
    <span class="n">sONEC</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">outer_sphere_charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]],</span>
    <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">metal_CN</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Molecule</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redistributes the oxidation state contributions across all metal atoms in</span>
<span class="sd">    the structure according to the outer sphere charge contribution (partially</span>
<span class="sd">    local distribution) &amp; calculates their associated electron counts.</span>
<span class="sd">    Features utilizing electron counts are minimally implemented at this time.</span>

<span class="sd">    Args:</span>
<span class="sd">        sONEC (dict[ccdc.molecule.Atom, list[float, float]]): dictionary with</span>
<span class="sd">                        metal Atom object as keys and lists containing the initial</span>
<span class="sd">                        oxidation state and electron count implied by only the equal</span>
<span class="sd">                        splitting of binding domain charges as values.</span>
<span class="sd">        outer_sphere_charge (int): sum of outer sphere charge contributions.</span>
<span class="sd">        IEs (dict[str, list(float)]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of  their reported ionization energies as values.</span>
<span class="sd">        ONP (dict[str, list(float)]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of the probability at the relevant oxidation</span>
<span class="sd">                        states as values.</span>
<span class="sd">        highest_known_ON (dict[str, int]) : dictionary with metal element symbols</span>
<span class="sd">                        as keys and a their highest known oxidation state as values.</span>
<span class="sd">        metal_CN (dict[ccdc.molecule.Molecule, int]): dictionary with as metal Atom</span>
<span class="sd">                        objects as keys and their  effective coordination number</span>
<span class="sd">                        as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        distributed_ONEC (dict[ccdc.molecule.Atom, list[float, float]]): dictionary</span>
<span class="sd">                        with metal Atom object as keys and lists containing their</span>
<span class="sd">                        redistributed oxidation state and electron count as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recursive_distributor</span><span class="p">(</span>
        <span class="n">iONEC</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">available_charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distribute network charge according to ionization energy and highest</span>
<span class="sd">        allowable oxidation state until all charge is distributed. Performed after</span>
<span class="sd">        tallying available network charge and sorting network metals by element type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initialize working dictionary</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iONEC</span><span class="p">)</span>

        <span class="c1"># positive contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get list of probable and improbable next oxidations</span>
            <span class="n">prob_metals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">dONEC</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span> <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lowestMetals</span> <span class="o">=</span> <span class="n">prob_metals</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">prob_metals</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">==</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestMetals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">improb_metals</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">==</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestMetals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lowestMetals</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">lowestMetals</span><span class="p">:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lowestMetals</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">lowestMetals</span><span class="p">:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lowestMetals</span><span class="p">))</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># negative contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get list of improbable and improbable next oxidations</span>
            <span class="n">prob_metals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">dONEC</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span> <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">highestMetals</span> <span class="o">=</span> <span class="n">prob_metals</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">prob_metals</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">==</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestMetals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">improb_metals</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">==</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestMetals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetals</span> <span class="o">=</span> <span class="p">[</span><span class="n">metal</span><span class="p">]</span>

            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">highestMetals</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">highestMetals</span><span class="p">:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">highestMetals</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">highestMetals</span><span class="p">:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">highestMetals</span><span class="p">))</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># if all charge has been distributed, we&#39;re done, otherwise, roll again</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dONEC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recursive_distributor</span><span class="p">(</span>
                <span class="n">dONEC</span><span class="p">,</span> <span class="n">available_charge</span><span class="p">,</span> <span class="n">IEs</span><span class="p">,</span> <span class="n">ONP</span><span class="p">,</span> <span class="n">highest_known_ON</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">outer_sphere_charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sONEC</span>

    <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># initialize dictionary for charge distribution</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sONEC</span><span class="p">:</span>
        <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># recursively distribute network charge according to ionization energy</span>
    <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="n">recursive_distributor</span><span class="p">(</span>
        <span class="n">distributed_ONEC</span><span class="p">,</span> <span class="n">outer_sphere_charge</span><span class="p">,</span> <span class="n">IEs</span><span class="p">,</span> <span class="n">ONP</span><span class="p">,</span> <span class="n">highest_known_ON</span>
    <span class="p">)</span>

    <span class="c1"># finally, adjust electron count to new oxidation state (OiL RiG)</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sONEC</span><span class="p">:</span>
        <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">valence_e</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">metal_CN</span><span class="p">[</span><span class="n">metal</span><span class="p">])</span> <span class="o">-</span> <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">distributed_ONEC</span></div>


<div class="viewcode-block" id="global_charge_distribution"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.global_charge_distribution">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">global_charge_distribution</span><span class="p">(</span>
    <span class="n">metalONdict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">metal_CN</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Molecule</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">most_probable_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redistributes the oxidation state contributions across all metal atoms in</span>
<span class="sd">    the structure according to full/global shating (fully delocalized distribution)</span>
<span class="sd">    &amp; calculates their associated electron counts. Features utilizing electron</span>
<span class="sd">    counts are minimally implemented at this time.</span>

<span class="sd">    Args:</span>
<span class="sd">        metalONdict (dict[ccdc.molecule.Atom, list[float, float]]): dictionary with</span>
<span class="sd">                        metal Atom object as keys and lists containing the initial</span>
<span class="sd">                        oxidation state and electron count implied by only the</span>
<span class="sd">                        equal splitting of binding domain charges as values.</span>
<span class="sd">        IEs (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of their reported ionization energies as values.</span>
<span class="sd">        ONP (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of the probability at the relevant oxidation</span>
<span class="sd">                        states as values.</span>
<span class="sd">        highest_known_ON (dict[str, int]) : dictionary with metal element symbols</span>
<span class="sd">                        as keys and a their highest known oxidation state as values.</span>
<span class="sd">        metal_CN (dict[ccdc.molecule.Molecule, int]): dictionary with as metal Atom</span>
<span class="sd">                        objects as keys and their effective coordination number</span>
<span class="sd">                        as values.</span>
<span class="sd">        most_probable_ON (dict[str, int]) : dictionary with metal element symbols</span>
<span class="sd">                        as keys and a their oxidation state with the highest</span>
<span class="sd">                        probability as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        global_ONEC (dict[ccdc.molecule.Atom, list[float, float]]): dictionary with</span>
<span class="sd">                        metal Atom object  as keys and lists containing their</span>
<span class="sd">                        redistributed oxidation state and electron count as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">global_ONEC</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recursive_distributor_global</span><span class="p">(</span>
        <span class="n">iONEC</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">available_charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sorted_metals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Atom</span><span class="p">],</span>
        <span class="n">IEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">highest_known_ON</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distribute network charge according to ionization energy and probability</span>
<span class="sd">        until all charge is distributed. Performed after tallying available network</span>
<span class="sd">        charge and sorting network metals by element type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initialize working dictionary</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dONEC</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iONEC</span><span class="p">)</span>

        <span class="c1"># positive contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># get list of improbable and improbable next oxidations</span>
            <span class="n">prob_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span>
                        <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>

            <span class="c1"># if only one metal type has a probable next oxidation state, do that</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">prob_metal_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if more than one metal type has a probable next oxidation state,</span>
            <span class="c1"># determine next lowest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># find lowest next ionization energy</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">prob_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># if there is no probable next oxidation state available,</span>
            <span class="c1"># determine lowest ionization energy among improbable next oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># find lowest next ionization energy</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">improb_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state at or higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;=</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;lowestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&lt;</span> <span class="n">lowestIE</span><span class="p">:</span>
                            <span class="n">lowestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">lowestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">lowestMetal</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># negative contribution?</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get list of improbable and improbable next oxidations</span>
            <span class="n">prob_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">improb_metal_type</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="mi">100</span>
                        <span class="o">*</span> <span class="n">ONP</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prob_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">improb_metal_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal_type</span><span class="p">)</span>

            <span class="c1"># if only one metal type has a probable next oxidation state, do that</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">prob_metal_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if more than one metal type has a probable next oxidation state,</span>
            <span class="c1"># determine next highest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">prob_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># if no probable next oxidation states are available,</span>
            <span class="c1"># determine next highest ionization energy among probable next</span>
            <span class="c1"># oxidation states</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">improb_metal_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metal_type</span> <span class="ow">in</span> <span class="n">improb_metal_type</span><span class="p">:</span>
                    <span class="c1"># metal in a negative oxidation state? Use IE = 0.</span>
                    <span class="k">if</span> <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># metal oxidation state higher than highest known? Set IE arbitrarily high.</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">&gt;</span> <span class="n">highest_known_ON</span><span class="p">[</span><span class="n">metal_type</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">currentIE</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="c1"># otherwise, use the appropriate IE.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                                <span class="p">(</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">),</span>
                                        <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">currentIE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                <span class="n">IEs</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span>
                                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dONEC</span><span class="p">[</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="o">-</span> <span class="mi">1</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;highestIE&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                        <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                        <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentIE</span> <span class="o">&gt;</span> <span class="n">highestIE</span><span class="p">:</span>
                            <span class="n">highestIE</span> <span class="o">=</span> <span class="n">currentIE</span>
                            <span class="n">highestMetal</span> <span class="o">=</span> <span class="n">metal_type</span>

            <span class="c1"># distribute one ionization energy level worth of charge</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">available_charge</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">available_charge</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">]:</span>
                    <span class="n">dONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">available_charge</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">sorted_metals</span><span class="p">[</span><span class="n">highestMetal</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="n">available_charge</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># if all charge has been distributed, we&#39;re done, otherwise, roll again</span>
        <span class="k">if</span> <span class="n">available_charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dONEC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recursive_distributor_global</span><span class="p">(</span>
                <span class="n">dONEC</span><span class="p">,</span> <span class="n">available_charge</span><span class="p">,</span> <span class="n">sorted_metals</span><span class="p">,</span> <span class="n">IEs</span><span class="p">,</span> <span class="n">ONP</span><span class="p">,</span> <span class="n">highest_known_ON</span>
            <span class="p">)</span>

    <span class="c1"># sort metals by element type</span>
    <span class="n">sorted_metals</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalONdict</span><span class="p">:</span>
        <span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalONdict</span><span class="p">:</span>
        <span class="n">sorted_metals</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>

    <span class="c1"># tally up the global charge to be distributed</span>
    <span class="c1"># and initialize global ON to most probable for all metals</span>
    <span class="n">global_charge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalONdict</span><span class="p">:</span>
        <span class="n">global_charge</span> <span class="o">+=</span> <span class="n">metalONdict</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">global_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">most_probable_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]]</span>
        <span class="n">global_charge</span> <span class="o">-=</span> <span class="n">most_probable_ON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]</span>
        <span class="n">global_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">metalONdict</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># recursively distribute network charge according to ionization energy</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">global_charge</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">):</span>
        <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="n">global_ONEC</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">distributed_ONEC</span> <span class="o">=</span> <span class="n">recursive_distributor_global</span><span class="p">(</span>
            <span class="n">global_ONEC</span><span class="p">,</span> <span class="n">global_charge</span><span class="p">,</span> <span class="n">sorted_metals</span><span class="p">,</span> <span class="n">IEs</span><span class="p">,</span> <span class="n">ONP</span><span class="p">,</span> <span class="n">highest_known_ON</span>
        <span class="p">)</span>

    <span class="c1"># finally, adjust electron count to new oxidation state (OiL RiG)</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">metalONdict</span><span class="p">:</span>
        <span class="n">global_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">valence_e</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">metal_CN</span><span class="p">[</span><span class="n">metal</span><span class="p">])</span> <span class="o">-</span> <span class="n">distributed_ONEC</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">global_ONEC</span></div>


<div class="viewcode-block" id="KnownONs"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.KnownONs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">KnownONs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in the known oxidation states for each metal element.</span>


<span class="sd">    Returns:</span>
<span class="sd">        KONs (dict[str, list(int)]) : dictionary with metal element symbols as keys</span>
<span class="sd">                              and a list of their known oxidation states as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">data_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            H	-1	1										</span>
<span class="s2">            He												</span>
<span class="s2">            Li	1											</span>
<span class="s2">            Be	0	1	2									</span>
<span class="s2">            B	-5	-1	0	1	2	3						</span>
<span class="s2">            C	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            N	-3	-2	-1	1	2	3	4	5				</span>
<span class="s2">            O	-2	-1	0	1	2							</span>
<span class="s2">            F	-1	0										</span>
<span class="s2">            Ne												</span>
<span class="s2">            Na	-1	1										</span>
<span class="s2">            Mg	0	1	2									</span>
<span class="s2">            Al	-2	-1	1	2	3							</span>
<span class="s2">            Si	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            P	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            S	-2	-1	0	1	2	3	4	5	6			</span>
<span class="s2">            Cl	-1	1	2	3	4	5	6	7				</span>
<span class="s2">            Ar	0											</span>
<span class="s2">            K	-1	1										</span>
<span class="s2">            Ca	0	1	2									</span>
<span class="s2">            Sc	0	1	2	3								</span>
<span class="s2">            Ti	-2	-1	0	1	2	3	4					</span>
<span class="s2">            V	-3	1	0	1	2	3	4	5				</span>
<span class="s2">            Cr	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Mn	-3	-2	-1	0	1	2	3	4	5	6	7	</span>
<span class="s2">            Fe	-4	-2	-1	0	1	2	3	4	5	6	7	</span>
<span class="s2">            Co	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            Ni	-2	-1	0	1	2	3	4					</span>
<span class="s2">            Cu	-2	0	1	2	3	4						</span>
<span class="s2">            Zn	-2	0	1	2								</span>
<span class="s2">            Ga	-5	-4	-3	-2	-1	1	2	3				</span>
<span class="s2">            Ge	-3	-2	-1	0	1	2	3	4				</span>
<span class="s2">            As	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            Se	-2	-1	1	2	3	4	5	6				</span>
<span class="s2">            Br	-1	1	3	4	5	7						</span>
<span class="s2">            Kr	0	1	2									</span>
<span class="s2">            Rb	-1	1										</span>
<span class="s2">            Sr	0	1	2									</span>
<span class="s2">            Y	0	1	2	3								</span>
<span class="s2">            Zr	-2	0	1	2	3	4						</span>
<span class="s2">            Nb	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            Mo	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Tc	-3	-1	0	1	2	3	4	5	6	7		</span>
<span class="s2">            Ru	-4	-2	0	1	2	3	4	5	6	7	8	</span>
<span class="s2">            Rh	-3	-1	0	1	2	3	4	5	6			</span>
<span class="s2">            Pd	0	1	2	3	4							</span>
<span class="s2">            Ag	-2	-1	1	2	3							</span>
<span class="s2">            Cd	-2	1	2									</span>
<span class="s2">            In	-5	-2	-2	1	2	3						</span>
<span class="s2">            Sn	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            Sb	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            Te	-2	-1	1	3	4	5	6	7				</span>
<span class="s2">            I	-1	1	3	4	5	6	7					</span>
<span class="s2">            Xe	0	2	4	6	8							</span>
<span class="s2">            Cs	-1	1										</span>
<span class="s2">            Ba	0	1	2									</span>
<span class="s2">            La	0	1	2	3								</span>
<span class="s2">            Ce	0	2	3	4								</span>
<span class="s2">            Pr	0	1	2	3	4	5						</span>
<span class="s2">            Nd	0	2	3	4								</span>
<span class="s2">            Pm	2	3										</span>
<span class="s2">            Sm	0	2	3									</span>
<span class="s2">            Eu	0	2	3									</span>
<span class="s2">            Gd	0	1	2	3								</span>
<span class="s2">            Tb	0	1	2	3	4							</span>
<span class="s2">            Dy	0	2	3	4								</span>
<span class="s2">            Ho	0	2	3									</span>
<span class="s2">            Er	0	2	3									</span>
<span class="s2">            Tm	0	2	3									</span>
<span class="s2">            Yb	0	2	3									</span>
<span class="s2">            Lu	0	2	3									</span>
<span class="s2">            Hf	-2	0	1	2	3	4						</span>
<span class="s2">            Ta	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            W	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Re	-3	-1	0	1	2	3	4	5	6	7		</span>
<span class="s2">            Os	-4	-2	-1	0	1	2	3	4	5	6	7	8</span>
<span class="s2">            Ir	-3	-1	0	1	2	3	4	5	6	7	8	9</span>
<span class="s2">            Pt	-3	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Au	-3	-2	-1	0	1	2	3	5				</span>
<span class="s2">            Hg	-2	1	2									</span>
<span class="s2">            Tl	-5	-2	-1	1	2	3						</span>
<span class="s2">            Pb	-4	-2	-1	1	2	3	4					</span>
<span class="s2">            Bi	-3	-2	-1	1	2	3	4	5				</span>
<span class="s2">            Po	-2	2	4	5	6							</span>
<span class="s2">            At	-1	1	3	5	7							</span>
<span class="s2">            Rn	2	6										</span>
<span class="s2">            Fr	1											</span>
<span class="s2">            Ra	2											</span>
<span class="s2">            Ac	2	3										</span>
<span class="s2">            Th	1	2	3	4								</span>
<span class="s2">            Pa	3	4	5									</span>
<span class="s2">            U	1	2	3	4	5	6						</span>
<span class="s2">            Np	2	3	4	5	6	7						</span>
<span class="s2">            Pu	2	3	4	5	6	7	8					</span>
<span class="s2">            Am	2	3	4	5	6	7						</span>
<span class="s2">            Cm	3	4	5	6								</span>
<span class="s2">            Bk	2	3	4	5								</span>
<span class="s2">            Cf	2	3	4	5								</span>
<span class="s2">            Es	2	3	4									</span>
<span class="s2">            Fm	2	3										</span>
<span class="s2">            Md	2	3										</span>
<span class="s2">            No	2	3										</span>
<span class="s2">            Lr	3											</span>
<span class="s2">            Rf	4											</span>
<span class="s2">            Db	5											</span>
<span class="s2">            Sg	0	6										</span>
<span class="s2">            Bh	7											</span>
<span class="s2">            Hs	8											</span>
<span class="s2">            Mt												</span>
<span class="s2">            Ds												</span>
<span class="s2">            Rg												</span>
<span class="s2">            Cn	2											</span>
<span class="s2">            Nh												</span>
<span class="s2">            Fl												</span>
<span class="s2">            Mc												</span>
<span class="s2">            Lv												</span>
<span class="s2">            Ts												</span>
<span class="s2">            Og												</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">KONs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># only parse lines with at least one oxidation state</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># map all remaining tokens to integers</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="n">KONs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">states</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no data: use empty list (or choose a default if you prefer)</span>
            <span class="n">KONs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">KONs</span></div>

<div class="viewcode-block" id="IonizationEnergies"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.IonizationEnergies">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">IonizationEnergies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in the reported ionization energies for each metal element.</span>

<span class="sd">    Returns:</span>
<span class="sd">        KIEs (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                          and a list of their reported ionization energies as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            0	H	13.5984346</span>
<span class="s2">            0	He	24.58738901</span>
<span class="s2">            1	He	54.41776549</span>
<span class="s2">            0	Li	5.391714996</span>
<span class="s2">            1	Li	75.640097</span>
<span class="s2">            2	Li	122.4543591</span>
<span class="s2">            0	Be	9.322699</span>
<span class="s2">            1	Be	18.21115</span>
<span class="s2">            2	Be	153.896205</span>
<span class="s2">            3	Be	217.7185861</span>
<span class="s2">            0	B	8.298019</span>
<span class="s2">            1	B	25.15483</span>
<span class="s2">            2	B	37.93059</span>
<span class="s2">            3	B	259.3715</span>
<span class="s2">            4	B	340.2260229</span>
<span class="s2">            0	C	11.260288</span>
<span class="s2">            1	C	24.383154</span>
<span class="s2">            2	C	47.88778</span>
<span class="s2">            3	C	64.49352</span>
<span class="s2">            4	C	392.090518</span>
<span class="s2">            5	C	489.993198</span>
<span class="s2">            0	N	14.53413</span>
<span class="s2">            1	N	29.60125</span>
<span class="s2">            2	N	47.4453</span>
<span class="s2">            3	N	77.4735</span>
<span class="s2">            4	N	97.8901</span>
<span class="s2">            5	N	552.06733</span>
<span class="s2">            6	N	667.046121</span>
<span class="s2">            0	O	13.618055</span>
<span class="s2">            1	O	35.12112</span>
<span class="s2">            2	O	54.93554</span>
<span class="s2">            3	O	77.4135</span>
<span class="s2">            4	O	113.899</span>
<span class="s2">            5	O	138.1189</span>
<span class="s2">            6	O	739.32683</span>
<span class="s2">            7	O	871.409883</span>
<span class="s2">            0	F	17.42282</span>
<span class="s2">            1	F	34.97081</span>
<span class="s2">            2	F	62.70798</span>
<span class="s2">            3	F	87.175</span>
<span class="s2">            4	F	114.249</span>
<span class="s2">            5	F	157.16311</span>
<span class="s2">            6	F	185.1868</span>
<span class="s2">            7	F	953.89805</span>
<span class="s2">            8	F	1103.11748</span>
<span class="s2">            0	Ne	21.564541</span>
<span class="s2">            1	Ne	40.96297</span>
<span class="s2">            2	Ne	63.4233</span>
<span class="s2">            3	Ne	97.19</span>
<span class="s2">            4	Ne	126.247</span>
<span class="s2">            5	Ne	157.934</span>
<span class="s2">            6	Ne	207.271</span>
<span class="s2">            7	Ne	239.097</span>
<span class="s2">            8	Ne	1195.80784</span>
<span class="s2">            9	Ne	1362.19916</span>
<span class="s2">            0	Na	5.13907696</span>
<span class="s2">            1	Na	47.28636</span>
<span class="s2">            2	Na	71.62</span>
<span class="s2">            3	Na	98.936</span>
<span class="s2">            4	Na	138.404</span>
<span class="s2">            5	Na	172.23</span>
<span class="s2">            6	Na	208.504</span>
<span class="s2">            7	Na	264.192</span>
<span class="s2">            8	Na	299.856</span>
<span class="s2">            9	Na	1465.134502</span>
<span class="s2">            0	Mg	7.646236</span>
<span class="s2">            1	Mg	15.035271</span>
<span class="s2">            2	Mg	80.1436</span>
<span class="s2">            3	Mg	109.2654</span>
<span class="s2">            4	Mg	141.33</span>
<span class="s2">            5	Mg	186.76</span>
<span class="s2">            6	Mg	225.02</span>
<span class="s2">            7	Mg	265.924</span>
<span class="s2">            8	Mg	327.99</span>
<span class="s2">            9	Mg	367.489</span>
<span class="s2">            0	Al	5.985769</span>
<span class="s2">            1	Al	18.82855</span>
<span class="s2">            2	Al	28.447642</span>
<span class="s2">            3	Al	119.9924</span>
<span class="s2">            4	Al	153.8252</span>
<span class="s2">            5	Al	190.49</span>
<span class="s2">            6	Al	241.76</span>
<span class="s2">            7	Al	284.64</span>
<span class="s2">            8	Al	330.21</span>
<span class="s2">            9	Al	398.65</span>
<span class="s2">            0	Si	8.15168</span>
<span class="s2">            1	Si	16.34585</span>
<span class="s2">            2	Si	33.493</span>
<span class="s2">            3	Si	45.14179</span>
<span class="s2">            4	Si	166.767</span>
<span class="s2">            5	Si	205.279</span>
<span class="s2">            6	Si	246.57</span>
<span class="s2">            7	Si	303.59</span>
<span class="s2">            8	Si	351.28</span>
<span class="s2">            9	Si	401.38</span>
<span class="s2">            0	P	10.486686</span>
<span class="s2">            1	P	19.76949</span>
<span class="s2">            2	P	30.20264</span>
<span class="s2">            3	P	51.44387</span>
<span class="s2">            4	P	65.02511</span>
<span class="s2">            5	P	220.43</span>
<span class="s2">            6	P	263.57</span>
<span class="s2">            7	P	309.6</span>
<span class="s2">            8	P	372.31</span>
<span class="s2">            9	P	424.4</span>
<span class="s2">            0	S	10.36001</span>
<span class="s2">            1	S	23.33788</span>
<span class="s2">            2	S	34.86</span>
<span class="s2">            3	S	47.222</span>
<span class="s2">            4	S	72.5945</span>
<span class="s2">            5	S	88.0529</span>
<span class="s2">            6	S	280.954</span>
<span class="s2">            7	S	328.794</span>
<span class="s2">            8	S	379.84</span>
<span class="s2">            9	S	447.7</span>
<span class="s2">            0	Cl	12.967633</span>
<span class="s2">            1	Cl	23.81364</span>
<span class="s2">            2	Cl	39.8</span>
<span class="s2">            3	Cl	53.24</span>
<span class="s2">            4	Cl	67.68</span>
<span class="s2">            5	Cl	96.94</span>
<span class="s2">            6	Cl	114.2013</span>
<span class="s2">            7	Cl	348.306</span>
<span class="s2">            8	Cl	400.851</span>
<span class="s2">            9	Cl	456.7</span>
<span class="s2">            0	Ar	15.7596119</span>
<span class="s2">            1	Ar	27.62967</span>
<span class="s2">            2	Ar	40.735</span>
<span class="s2">            3	Ar	59.58</span>
<span class="s2">            4	Ar	74.84</span>
<span class="s2">            5	Ar	91.29</span>
<span class="s2">            6	Ar	124.41</span>
<span class="s2">            7	Ar	143.4567</span>
<span class="s2">            8	Ar	422.6</span>
<span class="s2">            9	Ar	479.76</span>
<span class="s2">            0	K	4.34066373</span>
<span class="s2">            1	K	31.625</span>
<span class="s2">            2	K	45.8031</span>
<span class="s2">            3	K	60.917</span>
<span class="s2">            4	K	82.66</span>
<span class="s2">            5	K	99.44</span>
<span class="s2">            6	K	117.56</span>
<span class="s2">            7	K	154.87</span>
<span class="s2">            8	K	175.8174</span>
<span class="s2">            9	K	503.67</span>
<span class="s2">            0	Ca	6.11315547</span>
<span class="s2">            1	Ca	11.871719</span>
<span class="s2">            2	Ca	50.91316</span>
<span class="s2">            3	Ca	67.2732</span>
<span class="s2">            4	Ca	84.34</span>
<span class="s2">            5	Ca	108.78</span>
<span class="s2">            6	Ca	127.21</span>
<span class="s2">            7	Ca	147.24</span>
<span class="s2">            8	Ca	188.54</span>
<span class="s2">            9	Ca	211.275</span>
<span class="s2">            0	Sc	6.56149</span>
<span class="s2">            1	Sc	12.79977</span>
<span class="s2">            2	Sc	24.756839</span>
<span class="s2">            3	Sc	73.4894</span>
<span class="s2">            4	Sc	91.95</span>
<span class="s2">            5	Sc	110.68</span>
<span class="s2">            6	Sc	137.99</span>
<span class="s2">            7	Sc	158.08</span>
<span class="s2">            8	Sc	180.03</span>
<span class="s2">            9	Sc	225.18</span>
<span class="s2">            0	Ti	6.82812</span>
<span class="s2">            1	Ti	13.5755</span>
<span class="s2">            2	Ti	27.49171</span>
<span class="s2">            3	Ti	43.26717</span>
<span class="s2">            4	Ti	99.299</span>
<span class="s2">            5	Ti	119.533</span>
<span class="s2">            6	Ti	140.68</span>
<span class="s2">            7	Ti	170.5</span>
<span class="s2">            8	Ti	192.1</span>
<span class="s2">            9	Ti	215.92</span>
<span class="s2">            0	V	6.746187</span>
<span class="s2">            1	V	14.634</span>
<span class="s2">            2	V	29.3111</span>
<span class="s2">            3	V	46.709</span>
<span class="s2">            4	V	65.28165</span>
<span class="s2">            5	V	128.125</span>
<span class="s2">            6	V	150.72</span>
<span class="s2">            7	V	173.55</span>
<span class="s2">            8	V	206</span>
<span class="s2">            9	V	230.5</span>
<span class="s2">            0	Cr	6.76651</span>
<span class="s2">            1	Cr	16.486305</span>
<span class="s2">            2	Cr	30.959</span>
<span class="s2">            3	Cr	49.16</span>
<span class="s2">            4	Cr	69.46</span>
<span class="s2">            5	Cr	90.6349</span>
<span class="s2">            6	Cr	160.29</span>
<span class="s2">            7	Cr	184.76</span>
<span class="s2">            8	Cr	209.5</span>
<span class="s2">            9	Cr	244.5</span>
<span class="s2">            0	Mn	7.434038</span>
<span class="s2">            1	Mn	15.63999</span>
<span class="s2">            2	Mn	33.668</span>
<span class="s2">            3	Mn	51.21</span>
<span class="s2">            4	Mn	72.41</span>
<span class="s2">            5	Mn	95.604</span>
<span class="s2">            6	Mn	119.203</span>
<span class="s2">            7	Mn	195.5</span>
<span class="s2">            8	Mn	221.89</span>
<span class="s2">            9	Mn	248.6</span>
<span class="s2">            0	Fe	7.9024681</span>
<span class="s2">            1	Fe	16.19921</span>
<span class="s2">            2	Fe	30.651</span>
<span class="s2">            3	Fe	54.91</span>
<span class="s2">            4	Fe	75</span>
<span class="s2">            5	Fe	98.985</span>
<span class="s2">            6	Fe	124.976</span>
<span class="s2">            7	Fe	151.06</span>
<span class="s2">            8	Fe	233.6</span>
<span class="s2">            9	Fe	262.1</span>
<span class="s2">            0	Co	7.88101</span>
<span class="s2">            1	Co	17.0844</span>
<span class="s2">            2	Co	33.5</span>
<span class="s2">            3	Co	51.27</span>
<span class="s2">            4	Co	79.5</span>
<span class="s2">            5	Co	102</span>
<span class="s2">            6	Co	128.9</span>
<span class="s2">            7	Co	157.8</span>
<span class="s2">            8	Co	186.14</span>
<span class="s2">            9	Co	275.4</span>
<span class="s2">            0	Ni	7.639878</span>
<span class="s2">            1	Ni	18.168838</span>
<span class="s2">            2	Ni	35.187</span>
<span class="s2">            3	Ni	54.92</span>
<span class="s2">            4	Ni	76.06</span>
<span class="s2">            5	Ni	108</span>
<span class="s2">            6	Ni	132</span>
<span class="s2">            7	Ni	162</span>
<span class="s2">            8	Ni	193.2</span>
<span class="s2">            9	Ni	224.7</span>
<span class="s2">            0	Cu	7.72638</span>
<span class="s2">            1	Cu	20.29239</span>
<span class="s2">            2	Cu	36.841</span>
<span class="s2">            3	Cu	57.38</span>
<span class="s2">            4	Cu	79.8</span>
<span class="s2">            5	Cu	103</span>
<span class="s2">            6	Cu	139</span>
<span class="s2">            7	Cu	166</span>
<span class="s2">            8	Cu	198</span>
<span class="s2">            9	Cu	232.2</span>
<span class="s2">            0	Zn	9.394197</span>
<span class="s2">            1	Zn	17.96439</span>
<span class="s2">            2	Zn	39.7233</span>
<span class="s2">            3	Zn	59.573</span>
<span class="s2">            4	Zn	82.6</span>
<span class="s2">            5	Zn	108</span>
<span class="s2">            6	Zn	133.9</span>
<span class="s2">            7	Zn	173.9</span>
<span class="s2">            8	Zn	203</span>
<span class="s2">            9	Zn	238</span>
<span class="s2">            0	Ga	5.999302</span>
<span class="s2">            1	Ga	20.51514</span>
<span class="s2">            2	Ga	30.72576</span>
<span class="s2">            3	Ga	63.241</span>
<span class="s2">            4	Ga	86.01</span>
<span class="s2">            5	Ga	112.7</span>
<span class="s2">            6	Ga	140.8</span>
<span class="s2">            7	Ga	169.9</span>
<span class="s2">            8	Ga	211</span>
<span class="s2">            9	Ga	244</span>
<span class="s2">            0	Ge	7.899435</span>
<span class="s2">            1	Ge	15.93461</span>
<span class="s2">            2	Ge	34.0576</span>
<span class="s2">            3	Ge	45.7155</span>
<span class="s2">            4	Ge	90.5</span>
<span class="s2">            5	Ge	115.9</span>
<span class="s2">            6	Ge	144.9</span>
<span class="s2">            7	Ge	176.4</span>
<span class="s2">            8	Ge	212.5</span>
<span class="s2">            9	Ge	252.1</span>
<span class="s2">            0	As	9.78855</span>
<span class="s2">            1	As	18.5892</span>
<span class="s2">            2	As	28.349</span>
<span class="s2">            3	As	50.15</span>
<span class="s2">            4	As	62.77</span>
<span class="s2">            5	As	121.19</span>
<span class="s2">            6	As	147</span>
<span class="s2">            7	As	180</span>
<span class="s2">            8	As	213</span>
<span class="s2">            9	As	247</span>
<span class="s2">            0	Se	9.752392</span>
<span class="s2">            1	Se	21.196</span>
<span class="s2">            2	Se	31.697</span>
<span class="s2">            3	Se	42.947</span>
<span class="s2">            4	Se	68.3</span>
<span class="s2">            5	Se	81.83</span>
<span class="s2">            6	Se	155.327</span>
<span class="s2">            7	Se	184</span>
<span class="s2">            8	Se	219</span>
<span class="s2">            9	Se	255</span>
<span class="s2">            0	Br	11.81381</span>
<span class="s2">            1	Br	21.591</span>
<span class="s2">            2	Br	34.871</span>
<span class="s2">            3	Br	47.782</span>
<span class="s2">            4	Br	59.595</span>
<span class="s2">            5	Br	87.39</span>
<span class="s2">            6	Br	103.03</span>
<span class="s2">            7	Br	192.61</span>
<span class="s2">            8	Br	224</span>
<span class="s2">            9	Br	261</span>
<span class="s2">            0	Kr	13.9996055</span>
<span class="s2">            1	Kr	24.35984</span>
<span class="s2">            2	Kr	35.838</span>
<span class="s2">            3	Kr	50.85</span>
<span class="s2">            4	Kr	64.69</span>
<span class="s2">            5	Kr	78.49</span>
<span class="s2">            6	Kr	109.13</span>
<span class="s2">            7	Kr	125.802</span>
<span class="s2">            8	Kr	233</span>
<span class="s2">            9	Kr	268</span>
<span class="s2">            0	Rb	4.1771281</span>
<span class="s2">            1	Rb	27.28954</span>
<span class="s2">            2	Rb	39.247</span>
<span class="s2">            3	Rb	52.2</span>
<span class="s2">            4	Rb	68.44</span>
<span class="s2">            5	Rb	82.9</span>
<span class="s2">            6	Rb	98.67</span>
<span class="s2">            7	Rb	132.79</span>
<span class="s2">            8	Rb	150.628</span>
<span class="s2">            9	Rb	277.12</span>
<span class="s2">            0	Sr	5.69486745</span>
<span class="s2">            1	Sr	11.0302765</span>
<span class="s2">            2	Sr	42.88353</span>
<span class="s2">            3	Sr	56.28</span>
<span class="s2">            4	Sr	70.7</span>
<span class="s2">            5	Sr	88</span>
<span class="s2">            6	Sr	104</span>
<span class="s2">            7	Sr	121.21</span>
<span class="s2">            8	Sr	158.33</span>
<span class="s2">            9	Sr	177.3</span>
<span class="s2">            0	Y	6.21726</span>
<span class="s2">            1	Y	12.2236</span>
<span class="s2">            2	Y	20.52441</span>
<span class="s2">            3	Y	60.6072</span>
<span class="s2">            4	Y	75.35</span>
<span class="s2">            5	Y	91.39</span>
<span class="s2">            6	Y	110.02</span>
<span class="s2">            7	Y	128.12</span>
<span class="s2">            8	Y	145.64</span>
<span class="s2">            9	Y	185.7</span>
<span class="s2">            0	Zr	6.634126</span>
<span class="s2">            1	Zr	13.13</span>
<span class="s2">            2	Zr	23.17</span>
<span class="s2">            3	Zr	34.41836</span>
<span class="s2">            4	Zr	80.348</span>
<span class="s2">            5	Zr	96.38</span>
<span class="s2">            6	Zr	112</span>
<span class="s2">            7	Zr	133.7</span>
<span class="s2">            8	Zr	153</span>
<span class="s2">            9	Zr	172.02</span>
<span class="s2">            0	Nb	6.75885</span>
<span class="s2">            1	Nb	14.32</span>
<span class="s2">            2	Nb	25.04</span>
<span class="s2">            3	Nb	37.611</span>
<span class="s2">            4	Nb	50.5728</span>
<span class="s2">            5	Nb	102.069</span>
<span class="s2">            6	Nb	119.1</span>
<span class="s2">            7	Nb	136</span>
<span class="s2">            8	Nb	159.2</span>
<span class="s2">            9	Nb	180</span>
<span class="s2">            0	Mo	7.09243</span>
<span class="s2">            1	Mo	16.16</span>
<span class="s2">            2	Mo	27.13</span>
<span class="s2">            3	Mo	40.33</span>
<span class="s2">            4	Mo	54.417</span>
<span class="s2">            5	Mo	68.82704</span>
<span class="s2">            6	Mo	125.638</span>
<span class="s2">            7	Mo	143.6</span>
<span class="s2">            8	Mo	164.12</span>
<span class="s2">            9	Mo	186.3</span>
<span class="s2">            0	Tc	7.11938</span>
<span class="s2">            1	Tc	15.26</span>
<span class="s2">            2	Tc	29.55</span>
<span class="s2">            3	Tc	41</span>
<span class="s2">            4	Tc	57</span>
<span class="s2">            5	Tc	72</span>
<span class="s2">            6	Tc	88</span>
<span class="s2">            7	Tc	150</span>
<span class="s2">            8	Tc	169</span>
<span class="s2">            9	Tc	189.9</span>
<span class="s2">            0	Ru	7.3605</span>
<span class="s2">            1	Ru	16.76</span>
<span class="s2">            2	Ru	28.47</span>
<span class="s2">            3	Ru	45</span>
<span class="s2">            4	Ru	59</span>
<span class="s2">            5	Ru	76</span>
<span class="s2">            6	Ru	93</span>
<span class="s2">            7	Ru	110</span>
<span class="s2">            8	Ru	178.41</span>
<span class="s2">            9	Ru	198</span>
<span class="s2">            0	Rh	7.4589</span>
<span class="s2">            1	Rh	18.08</span>
<span class="s2">            2	Rh	31.06</span>
<span class="s2">            3	Rh	42</span>
<span class="s2">            4	Rh	63</span>
<span class="s2">            5	Rh	80</span>
<span class="s2">            6	Rh	97</span>
<span class="s2">            7	Rh	115.1</span>
<span class="s2">            8	Rh	135</span>
<span class="s2">            9	Rh	207.51</span>
<span class="s2">            0	Pd	8.336839</span>
<span class="s2">            1	Pd	19.43</span>
<span class="s2">            2	Pd	32.93</span>
<span class="s2">            3	Pd	46</span>
<span class="s2">            4	Pd	61</span>
<span class="s2">            5	Pd	84.1</span>
<span class="s2">            6	Pd	101</span>
<span class="s2">            7	Pd	120</span>
<span class="s2">            8	Pd	141</span>
<span class="s2">            9	Pd	159.9</span>
<span class="s2">            0	Ag	7.576234</span>
<span class="s2">            1	Ag	21.4844</span>
<span class="s2">            2	Ag	34.8</span>
<span class="s2">            3	Ag	49</span>
<span class="s2">            4	Ag	65</span>
<span class="s2">            5	Ag	82</span>
<span class="s2">            6	Ag	106</span>
<span class="s2">            7	Ag	125</span>
<span class="s2">            8	Ag	145.1</span>
<span class="s2">            9	Ag	167</span>
<span class="s2">            0	Cd	8.99382</span>
<span class="s2">            1	Cd	16.908313</span>
<span class="s2">            2	Cd	37.468</span>
<span class="s2">            3	Cd	51</span>
<span class="s2">            4	Cd	67.9</span>
<span class="s2">            5	Cd	87</span>
<span class="s2">            6	Cd	105</span>
<span class="s2">            7	Cd	130.1</span>
<span class="s2">            8	Cd	150</span>
<span class="s2">            9	Cd	173</span>
<span class="s2">            0	In	5.7863558</span>
<span class="s2">            1	In	18.87041</span>
<span class="s2">            2	In	28.04415</span>
<span class="s2">            3	In	55.45</span>
<span class="s2">            4	In	69.3</span>
<span class="s2">            5	In	90</span>
<span class="s2">            6	In	109</span>
<span class="s2">            7	In	130.1</span>
<span class="s2">            8	In	156</span>
<span class="s2">            9	In	178</span>
<span class="s2">            0	Sn	7.343918</span>
<span class="s2">            1	Sn	14.63307</span>
<span class="s2">            2	Sn	30.506</span>
<span class="s2">            3	Sn	40.74</span>
<span class="s2">            4	Sn	77.03</span>
<span class="s2">            5	Sn	94</span>
<span class="s2">            6	Sn	112.9</span>
<span class="s2">            7	Sn	135</span>
<span class="s2">            8	Sn	156</span>
<span class="s2">            9	Sn	184</span>
<span class="s2">            0	Sb	8.608389</span>
<span class="s2">            1	Sb	16.626</span>
<span class="s2">            2	Sb	25.3235</span>
<span class="s2">            3	Sb	43.804</span>
<span class="s2">            4	Sb	55</span>
<span class="s2">            5	Sb	99.51</span>
<span class="s2">            6	Sb	117</span>
<span class="s2">            7	Sb	139</span>
<span class="s2">            8	Sb	162</span>
<span class="s2">            9	Sb	185</span>
<span class="s2">            0	Tb	9.009808</span>
<span class="s2">            1	Tb	18.6</span>
<span class="s2">            2	Tb	27.84</span>
<span class="s2">            3	Tb	37.4155</span>
<span class="s2">            4	Tb	59.3</span>
<span class="s2">            5	Tb	69.1</span>
<span class="s2">            6	Tb	124.2</span>
<span class="s2">            7	Tb	143</span>
<span class="s2">            8	Tb	167</span>
<span class="s2">            9	Tb	191.1</span>
<span class="s2">            0	I	10.45126</span>
<span class="s2">            1	I	19.13126</span>
<span class="s2">            2	I	29.57</span>
<span class="s2">            3	I	40.357</span>
<span class="s2">            4	I	51.52</span>
<span class="s2">            5	I	74.4</span>
<span class="s2">            6	I	87.61</span>
<span class="s2">            7	I	150.81</span>
<span class="s2">            8	I	171</span>
<span class="s2">            9	I	197</span>
<span class="s2">            0	Xe	12.1298437</span>
<span class="s2">            1	Xe	20.975</span>
<span class="s2">            2	Xe	31.05</span>
<span class="s2">            3	Xe	42.2</span>
<span class="s2">            4	Xe	54.1</span>
<span class="s2">            5	Xe	66.703</span>
<span class="s2">            6	Xe	91.6</span>
<span class="s2">            7	Xe	105.9778</span>
<span class="s2">            8	Xe	179.84</span>
<span class="s2">            9	Xe	202</span>
<span class="s2">            0	Cs	3.893905727</span>
<span class="s2">            1	Cs	23.15745</span>
<span class="s2">            2	Cs	33.195</span>
<span class="s2">            3	Cs	43</span>
<span class="s2">            4	Cs	56</span>
<span class="s2">            5	Cs	69.1</span>
<span class="s2">            6	Cs	82.9</span>
<span class="s2">            7	Cs	110.1</span>
<span class="s2">            8	Cs	125.61</span>
<span class="s2">            9	Cs	213.3</span>
<span class="s2">            0	Ba	5.2116646</span>
<span class="s2">            1	Ba	10.003826</span>
<span class="s2">            2	Ba	35.8438</span>
<span class="s2">            3	Ba	47</span>
<span class="s2">            4	Ba	58</span>
<span class="s2">            5	Ba	71</span>
<span class="s2">            6	Ba	86</span>
<span class="s2">            7	Ba	101</span>
<span class="s2">            8	Ba	130.5</span>
<span class="s2">            9	Ba	146.52</span>
<span class="s2">            0	La	5.5769</span>
<span class="s2">            1	La	11.18496</span>
<span class="s2">            2	La	19.1773</span>
<span class="s2">            3	La	49.95</span>
<span class="s2">            4	La	61.6</span>
<span class="s2">            5	La	74</span>
<span class="s2">            6	La	88</span>
<span class="s2">            7	La	105</span>
<span class="s2">            8	La	119</span>
<span class="s2">            9	La	151.4</span>
<span class="s2">            0	Ce	5.5386</span>
<span class="s2">            1	Ce	10.956</span>
<span class="s2">            2	Ce	20.1974</span>
<span class="s2">            3	Ce	36.906</span>
<span class="s2">            4	Ce	65.55</span>
<span class="s2">            5	Ce	77.6</span>
<span class="s2">            6	Ce	91</span>
<span class="s2">            7	Ce	106</span>
<span class="s2">            8	Ce	125</span>
<span class="s2">            9	Ce	140</span>
<span class="s2">            0	Pr	5.4702</span>
<span class="s2">            1	Pr	10.631</span>
<span class="s2">            2	Pr	21.6237</span>
<span class="s2">            3	Pr	38.981</span>
<span class="s2">            4	Pr	57.53</span>
<span class="s2">            5	Pr	82</span>
<span class="s2">            6	Pr	97</span>
<span class="s2">            7	Pr	112</span>
<span class="s2">            8	Pr	131</span>
<span class="s2">            9	Pr	148</span>
<span class="s2">            0	Nd	5.525</span>
<span class="s2">            1	Nd	10.783</span>
<span class="s2">            2	Nd	22.09</span>
<span class="s2">            3	Nd	40.6</span>
<span class="s2">            4	Nd	60</span>
<span class="s2">            5	Nd	84</span>
<span class="s2">            6	Nd	99</span>
<span class="s2">            7	Nd	114</span>
<span class="s2">            8	Nd	136</span>
<span class="s2">            9	Nd	152</span>
<span class="s2">            0	Pm	5.58187</span>
<span class="s2">            1	Pm	10.938</span>
<span class="s2">            2	Pm	22.44</span>
<span class="s2">            3	Pm	41.17</span>
<span class="s2">            4	Pm	61.7</span>
<span class="s2">            5	Pm	85</span>
<span class="s2">            6	Pm	101</span>
<span class="s2">            7	Pm	116</span>
<span class="s2">            8	Pm	138</span>
<span class="s2">            9	Pm	155</span>
<span class="s2">            0	Sm	5.643722</span>
<span class="s2">            1	Sm	11.078</span>
<span class="s2">            2	Sm	23.55</span>
<span class="s2">            3	Sm	41.64</span>
<span class="s2">            4	Sm	62.7</span>
<span class="s2">            5	Sm	87</span>
<span class="s2">            6	Sm	103</span>
<span class="s2">            7	Sm	118</span>
<span class="s2">            8	Sm	141</span>
<span class="s2">            9	Sm	158</span>
<span class="s2">            0	Eu	5.670385</span>
<span class="s2">            1	Eu	11.24</span>
<span class="s2">            2	Eu	24.84</span>
<span class="s2">            3	Eu	42.94</span>
<span class="s2">            4	Eu	63.2</span>
<span class="s2">            5	Eu	89</span>
<span class="s2">            6	Eu	105</span>
<span class="s2">            7	Eu	120</span>
<span class="s2">            8	Eu	144</span>
<span class="s2">            9	Eu	161</span>
<span class="s2">            0	Gd	6.1498</span>
<span class="s2">            1	Gd	12.076</span>
<span class="s2">            2	Gd	20.54</span>
<span class="s2">            3	Gd	44.44</span>
<span class="s2">            4	Gd	64.8</span>
<span class="s2">            5	Gd	89</span>
<span class="s2">            6	Gd	106</span>
<span class="s2">            7	Gd	123</span>
<span class="s2">            8	Gd	144</span>
<span class="s2">            9	Gd	165</span>
<span class="s2">            0	Tb	5.8638</span>
<span class="s2">            1	Tb	11.513</span>
<span class="s2">            2	Tb	21.82</span>
<span class="s2">            3	Tb	39.33</span>
<span class="s2">            4	Tb	66.5</span>
<span class="s2">            5	Tb	90</span>
<span class="s2">            6	Tb	108</span>
<span class="s2">            7	Tb	125</span>
<span class="s2">            8	Tb	143</span>
<span class="s2">            9	Tb	168</span>
<span class="s2">            0	Dy	5.93905</span>
<span class="s2">            1	Dy	11.647</span>
<span class="s2">            2	Dy	22.89</span>
<span class="s2">            3	Dy	41.23</span>
<span class="s2">            4	Dy	62.1</span>
<span class="s2">            5	Dy	93</span>
<span class="s2">            6	Dy	110</span>
<span class="s2">            7	Dy	127</span>
<span class="s2">            8	Dy	152</span>
<span class="s2">            9	Dy	170</span>
<span class="s2">            0	Ho	6.0215</span>
<span class="s2">            1	Ho	11.781</span>
<span class="s2">            2	Ho	22.79</span>
<span class="s2">            3	Ho	42.52</span>
<span class="s2">            4	Ho	63.9</span>
<span class="s2">            5	Ho	95</span>
<span class="s2">            6	Ho	112</span>
<span class="s2">            7	Ho	129</span>
<span class="s2">            8	Ho	155</span>
<span class="s2">            9	Ho	173</span>
<span class="s2">            0	Er	6.1077</span>
<span class="s2">            1	Er	11.916</span>
<span class="s2">            2	Er	22.7</span>
<span class="s2">            3	Er	42.42</span>
<span class="s2">            4	Er	65.1</span>
<span class="s2">            5	Er	96</span>
<span class="s2">            6	Er	114</span>
<span class="s2">            7	Er	131</span>
<span class="s2">            8	Er	158</span>
<span class="s2">            9	Er	177</span>
<span class="s2">            0	Tm	6.18431</span>
<span class="s2">            1	Tm	12.065</span>
<span class="s2">            2	Tm	23.66</span>
<span class="s2">            3	Tm	42.41</span>
<span class="s2">            4	Tm	65.4</span>
<span class="s2">            5	Tm	98</span>
<span class="s2">            6	Tm	116</span>
<span class="s2">            7	Tm	133</span>
<span class="s2">            8	Tm	160</span>
<span class="s2">            9	Tm	180</span>
<span class="s2">            0	Yb	6.25416</span>
<span class="s2">            1	Yb	12.179185</span>
<span class="s2">            2	Yb	25.053</span>
<span class="s2">            3	Yb	43.61</span>
<span class="s2">            4	Yb	65.6</span>
<span class="s2">            5	Yb	99</span>
<span class="s2">            6	Yb	117</span>
<span class="s2">            7	Yb	135</span>
<span class="s2">            8	Yb	163</span>
<span class="s2">            9	Yb	182</span>
<span class="s2">            0	Lu	5.425871</span>
<span class="s2">            1	Lu	14.13</span>
<span class="s2">            2	Lu	20.9594</span>
<span class="s2">            3	Lu	45.249</span>
<span class="s2">            4	Lu	66.8</span>
<span class="s2">            5	Lu	98</span>
<span class="s2">            6	Lu	117</span>
<span class="s2">            7	Lu	136</span>
<span class="s2">            8	Lu	159</span>
<span class="s2">            9	Lu	185</span>
<span class="s2">            0	Hf	6.82507</span>
<span class="s2">            1	Hf	14.61</span>
<span class="s2">            2	Hf	22.55</span>
<span class="s2">            3	Hf	33.37</span>
<span class="s2">            4	Hf	68.37</span>
<span class="s2">            5	Hf	98</span>
<span class="s2">            6	Hf	118</span>
<span class="s2">            7	Hf	137</span>
<span class="s2">            8	Hf	157</span>
<span class="s2">            9	Hf	187</span>
<span class="s2">            0	Ta	7.549571</span>
<span class="s2">            1	Ta	16.2</span>
<span class="s2">            2	Ta	23.1</span>
<span class="s2">            3	Ta	35</span>
<span class="s2">            4	Ta	48.272</span>
<span class="s2">            5	Ta	94.01</span>
<span class="s2">            6	Ta	119</span>
<span class="s2">            7	Ta	139</span>
<span class="s2">            8	Ta	159</span>
<span class="s2">            9	Ta	180</span>
<span class="s2">            0	W	7.86403</span>
<span class="s2">            1	W	16.37</span>
<span class="s2">            2	W	26</span>
<span class="s2">            3	W	38.2</span>
<span class="s2">            4	W	51.6</span>
<span class="s2">            5	W	64.77</span>
<span class="s2">            6	W	122.01</span>
<span class="s2">            7	W	141.2</span>
<span class="s2">            8	W	160.2</span>
<span class="s2">            9	W	179</span>
<span class="s2">            0	Re	7.83352</span>
<span class="s2">            1	Re	16.6</span>
<span class="s2">            2	Re	27</span>
<span class="s2">            3	Re	39.1</span>
<span class="s2">            4	Re	51.9</span>
<span class="s2">            5	Re	67</span>
<span class="s2">            6	Re	82.71</span>
<span class="s2">            7	Re	144.4</span>
<span class="s2">            8	Re	165</span>
<span class="s2">            9	Re	187</span>
<span class="s2">            0	Os	8.43823</span>
<span class="s2">            1	Os	17</span>
<span class="s2">            2	Os	25</span>
<span class="s2">            3	Os	41</span>
<span class="s2">            4	Os	55</span>
<span class="s2">            5	Os	70.1</span>
<span class="s2">            6	Os	85.1</span>
<span class="s2">            7	Os	102.02</span>
<span class="s2">            8	Os	168.7</span>
<span class="s2">            9	Os	190</span>
<span class="s2">            0	Ir	8.96702</span>
<span class="s2">            1	Ir	17</span>
<span class="s2">            2	Ir	28</span>
<span class="s2">            3	Ir	40</span>
<span class="s2">            4	Ir	57</span>
<span class="s2">            5	Ir	72</span>
<span class="s2">            6	Ir	89</span>
<span class="s2">            7	Ir	105</span>
<span class="s2">            8	Ir	122.7</span>
<span class="s2">            9	Ir	194.8</span>
<span class="s2">            0	Pt	8.95883</span>
<span class="s2">            1	Pt	18.56</span>
<span class="s2">            2	Pt	29</span>
<span class="s2">            3	Pt	43</span>
<span class="s2">            4	Pt	56</span>
<span class="s2">            5	Pt	75</span>
<span class="s2">            6	Pt	91</span>
<span class="s2">            7	Pt	109</span>
<span class="s2">            8	Pt	126</span>
<span class="s2">            9	Pt	144.9</span>
<span class="s2">            0	Au	9.225554</span>
<span class="s2">            1	Au	20.203</span>
<span class="s2">            2	Au	30</span>
<span class="s2">            3	Au	45</span>
<span class="s2">            4	Au	60</span>
<span class="s2">            5	Au	74</span>
<span class="s2">            6	Au	94</span>
<span class="s2">            7	Au	112</span>
<span class="s2">            8	Au	130.1</span>
<span class="s2">            9	Au	149</span>
<span class="s2">            0	Hg	10.437504</span>
<span class="s2">            1	Hg	18.75688</span>
<span class="s2">            2	Hg	34.49</span>
<span class="s2">            3	Hg	48.55</span>
<span class="s2">            4	Hg	61.2</span>
<span class="s2">            5	Hg	76.6</span>
<span class="s2">            6	Hg	93</span>
<span class="s2">            7	Hg	113.9</span>
<span class="s2">            8	Hg	134</span>
<span class="s2">            9	Hg	153</span>
<span class="s2">            0	Tl	6.1082873</span>
<span class="s2">            1	Tl	20.4283</span>
<span class="s2">            2	Tl	29.852</span>
<span class="s2">            3	Tl	51.14</span>
<span class="s2">            4	Tl	62.6</span>
<span class="s2">            5	Tl	80</span>
<span class="s2">            6	Tl	97.9</span>
<span class="s2">            7	Tl	116</span>
<span class="s2">            8	Tl	135</span>
<span class="s2">            9	Tl	158</span>
<span class="s2">            0	Pb	7.4166799</span>
<span class="s2">            1	Pb	15.032499</span>
<span class="s2">            2	Pb	31.9373</span>
<span class="s2">            3	Pb	42.33256</span>
<span class="s2">            4	Pb	68.8</span>
<span class="s2">            5	Pb	82.9</span>
<span class="s2">            6	Pb	100.1</span>
<span class="s2">            7	Pb	120</span>
<span class="s2">            8	Pb	138</span>
<span class="s2">            9	Pb	158</span>
<span class="s2">            0	Bi	7.285516</span>
<span class="s2">            1	Bi	16.703</span>
<span class="s2">            2	Bi	25.57075</span>
<span class="s2">            3	Bi	45.37</span>
<span class="s2">            4	Bi	54.856</span>
<span class="s2">            5	Bi	88.4</span>
<span class="s2">            6	Bi	103</span>
<span class="s2">            7	Bi	122</span>
<span class="s2">            8	Bi	143</span>
<span class="s2">            9	Bi	161.1</span>
<span class="s2">            0	Po	8.41807</span>
<span class="s2">            1	Po	19.3</span>
<span class="s2">            2	Po	27.3</span>
<span class="s2">            3	Po	36</span>
<span class="s2">            4	Po	57</span>
<span class="s2">            5	Po	69.1</span>
<span class="s2">            6	Po	108</span>
<span class="s2">            7	Po	125</span>
<span class="s2">            8	Po	146.1</span>
<span class="s2">            9	Po	166</span>
<span class="s2">            0	At	9.31751</span>
<span class="s2">            1	At	17.88</span>
<span class="s2">            2	At	26.58</span>
<span class="s2">            3	At	39.65</span>
<span class="s2">            4	At	50.39</span>
<span class="s2">            5	At	72</span>
<span class="s2">            6	At	85.1</span>
<span class="s2">            7	At	130.1</span>
<span class="s2">            8	At	149</span>
<span class="s2">            9	At	169</span>
<span class="s2">            0	Rn	10.7485</span>
<span class="s2">            1	Rn	21.4</span>
<span class="s2">            2	Rn	29.4</span>
<span class="s2">            3	Rn	36.9</span>
<span class="s2">            4	Rn	52.9</span>
<span class="s2">            5	Rn	64</span>
<span class="s2">            6	Rn	88</span>
<span class="s2">            7	Rn	102</span>
<span class="s2">            8	Rn	154</span>
<span class="s2">            9	Rn	173.9</span>
<span class="s2">            0	Fr	4.0727411</span>
<span class="s2">            1	Fr	22.4</span>
<span class="s2">            2	Fr	33.5</span>
<span class="s2">            3	Fr	39.1</span>
<span class="s2">            4	Fr	50</span>
<span class="s2">            5	Fr	67</span>
<span class="s2">            6	Fr	80</span>
<span class="s2">            7	Fr	106</span>
<span class="s2">            8	Fr	120</span>
<span class="s2">            9	Fr	179</span>
<span class="s2">            0	Ra	5.2784239</span>
<span class="s2">            1	Ra	10.14718</span>
<span class="s2">            2	Ra	31</span>
<span class="s2">            3	Ra	41</span>
<span class="s2">            4	Ra	52.9</span>
<span class="s2">            5	Ra	64</span>
<span class="s2">            6	Ra	82</span>
<span class="s2">            7	Ra	97</span>
<span class="s2">            8	Ra	124</span>
<span class="s2">            9	Ra	140</span>
<span class="s2">            0	Ac	5.380226</span>
<span class="s2">            1	Ac	11.75</span>
<span class="s2">            2	Ac	17.431</span>
<span class="s2">            3	Ac	44.8</span>
<span class="s2">            4	Ac	55</span>
<span class="s2">            5	Ac	67</span>
<span class="s2">            6	Ac	79</span>
<span class="s2">            7	Ac	98.9</span>
<span class="s2">            8	Ac	113.9</span>
<span class="s2">            9	Ac	143.9</span>
<span class="s2">            0	Th	6.3067</span>
<span class="s2">            1	Th	12.1</span>
<span class="s2">            2	Th	18.32</span>
<span class="s2">            3	Th	28.648</span>
<span class="s2">            4	Th	58</span>
<span class="s2">            5	Th	69.1</span>
<span class="s2">            6	Th	82</span>
<span class="s2">            7	Th	95</span>
<span class="s2">            8	Th	118</span>
<span class="s2">            9	Th	133</span>
<span class="s2">            0	Pa	5.89</span>
<span class="s2">            1	Pa	11.9</span>
<span class="s2">            2	Pa	18.6</span>
<span class="s2">            3	Pa	30.9</span>
<span class="s2">            4	Pa	44.3</span>
<span class="s2">            5	Pa	72</span>
<span class="s2">            6	Pa	85.1</span>
<span class="s2">            7	Pa	98.9</span>
<span class="s2">            8	Pa	111</span>
<span class="s2">            9	Pa	137</span>
<span class="s2">            0	U	6.19405</span>
<span class="s2">            1	U	11.6</span>
<span class="s2">            2	U	19.8</span>
<span class="s2">            3	U	36.7</span>
<span class="s2">            4	U	46</span>
<span class="s2">            5	U	62</span>
<span class="s2">            6	U	89</span>
<span class="s2">            7	U	101</span>
<span class="s2">            8	U	116</span>
<span class="s2">            9	U	128.9</span>
<span class="s2">            0	Np	6.26554</span>
<span class="s2">            1	Np	11.5</span>
<span class="s2">            2	Np	19.7</span>
<span class="s2">            3	Np	33.8</span>
<span class="s2">            4	Np	48</span>
<span class="s2">            5	Np	65</span>
<span class="s2">            6	Np	92</span>
<span class="s2">            7	Np	107</span>
<span class="s2">            8	Np	121</span>
<span class="s2">            9	Np	136</span>
<span class="s2">            0	Pu	6.02576</span>
<span class="s2">            1	Pu	11.5</span>
<span class="s2">            2	Pu	21.1</span>
<span class="s2">            3	Pu	35</span>
<span class="s2">            4	Pu	49</span>
<span class="s2">            5	Pu	80</span>
<span class="s2">            6	Pu	95</span>
<span class="s2">            7	Pu	109</span>
<span class="s2">            8	Pu	124</span>
<span class="s2">            9	Pu	139</span>
<span class="s2">            0	Am	5.97381</span>
<span class="s2">            1	Am	11.7</span>
<span class="s2">            2	Am	21.7</span>
<span class="s2">            3	Am	36.8</span>
<span class="s2">            4	Am	50</span>
<span class="s2">            5	Am	67.9</span>
<span class="s2">            6	Am	95</span>
<span class="s2">            7	Am	110</span>
<span class="s2">            8	Am	125</span>
<span class="s2">            9	Am	141</span>
<span class="s2">            0	Cm	5.99141</span>
<span class="s2">            1	Cm	12.4</span>
<span class="s2">            2	Cm	20.1</span>
<span class="s2">            3	Cm	37.7</span>
<span class="s2">            4	Cm	51</span>
<span class="s2">            5	Cm	69.1</span>
<span class="s2">            6	Cm	97</span>
<span class="s2">            7	Cm	112</span>
<span class="s2">            8	Cm	128</span>
<span class="s2">            9	Cm	144</span>
<span class="s2">            0	Bk	6.19785</span>
<span class="s2">            1	Bk	11.9</span>
<span class="s2">            2	Bk	21.6</span>
<span class="s2">            3	Bk	36</span>
<span class="s2">            4	Bk	56</span>
<span class="s2">            5	Bk	70.1</span>
<span class="s2">            6	Bk	90</span>
<span class="s2">            7	Bk	114</span>
<span class="s2">            8	Bk	130</span>
<span class="s2">            9	Bk	147</span>
<span class="s2">            0	Cf	6.28166</span>
<span class="s2">            1	Cf	12</span>
<span class="s2">            2	Cf	22.4</span>
<span class="s2">            3	Cf	37.7</span>
<span class="s2">            4	Cf	51.9</span>
<span class="s2">            5	Cf	75</span>
<span class="s2">            6	Cf	91</span>
<span class="s2">            7	Cf	112.9</span>
<span class="s2">            8	Cf	133</span>
<span class="s2">            9	Cf	152</span>
<span class="s2">            0	Es	6.36758</span>
<span class="s2">            1	Es	12.2</span>
<span class="s2">            2	Es	22.7</span>
<span class="s2">            3	Es	38.8</span>
<span class="s2">            4	Es	54.1</span>
<span class="s2">            5	Es	71</span>
<span class="s2">            6	Es	97</span>
<span class="s2">            7	Es	112.9</span>
<span class="s2">            8	Es	137</span>
<span class="s2">            9	Es	157</span>
<span class="s2">            0	Fm	6.5</span>
<span class="s2">            1	Fm	12.4</span>
<span class="s2">            2	Fm	23.2</span>
<span class="s2">            3	Fm	39.3</span>
<span class="s2">            4	Fm	55</span>
<span class="s2">            5	Fm	74</span>
<span class="s2">            6	Fm	93</span>
<span class="s2">            7	Fm	120</span>
<span class="s2">            8	Fm	136</span>
<span class="s2">            9	Fm	162</span>
<span class="s2">            0	Md	6.58</span>
<span class="s2">            1	Md	12.4</span>
<span class="s2">            2	Md	24.3</span>
<span class="s2">            3	Md	40</span>
<span class="s2">            4	Md	54.1</span>
<span class="s2">            5	Md	76</span>
<span class="s2">            6	Md	96</span>
<span class="s2">            7	Md	115.1</span>
<span class="s2">            8	Md	143.9</span>
<span class="s2">            9	Md	162</span>
<span class="s2">            0	No	6.62621</span>
<span class="s2">            1	No	12.93</span>
<span class="s2">            2	No	25.8</span>
<span class="s2">            3	No	41.5</span>
<span class="s2">            4	No	60</span>
<span class="s2">            5	No	74</span>
<span class="s2">            6	No	97</span>
<span class="s2">            7	No	119</span>
<span class="s2">            8	No	140</span>
<span class="s2">            9	No	170</span>
<span class="s2">            0	Lr	4.96</span>
<span class="s2">            1	Lr	14.54</span>
<span class="s2">            2	Lr	21.8</span>
<span class="s2">            3	Lr	43.6</span>
<span class="s2">            4	Lr	56</span>
<span class="s2">            5	Lr	80</span>
<span class="s2">            6	Lr	96</span>
<span class="s2">            7	Lr	121</span>
<span class="s2">            8	Lr	143</span>
<span class="s2">            9	Lr	165</span>
<span class="s2">            0	Rf	6.02</span>
<span class="s2">            1	Rf	14.35</span>
<span class="s2">            2	Rf	23.84</span>
<span class="s2">            3	Rf	31.87</span>
<span class="s2">            4	Rf	64</span>
<span class="s2">            5	Rf	77</span>
<span class="s2">            6	Rf	102</span>
<span class="s2">            7	Rf	119</span>
<span class="s2">            8	Rf	146.1</span>
<span class="s2">            9	Rf	169</span>
<span class="s2">            0	Db	6.8</span>
<span class="s2">            1	Db	14</span>
<span class="s2">            2	Db	23.1</span>
<span class="s2">            3	Db	33</span>
<span class="s2">            4	Db	43</span>
<span class="s2">            5	Db	86</span>
<span class="s2">            6	Db	98.9</span>
<span class="s2">            7	Db	126</span>
<span class="s2">            8	Db	145.1</span>
<span class="s2">            9	Db	172</span>
<span class="s2">            0	Sg	7.8</span>
<span class="s2">            1	Sg	17.1</span>
<span class="s2">            2	Sg	25.8</span>
<span class="s2">            3	Sg	35.5</span>
<span class="s2">            4	Sg	47.2</span>
<span class="s2">            5	Sg	59.3</span>
<span class="s2">            6	Sg	109</span>
<span class="s2">            7	Sg	122</span>
<span class="s2">            8	Sg	152</span>
<span class="s2">            9	Sg	170</span>
<span class="s2">            0	Bh	7.7</span>
<span class="s2">            1	Bh	17.5</span>
<span class="s2">            2	Bh	26.7</span>
<span class="s2">            3	Bh	37.3</span>
<span class="s2">            4	Bh	49</span>
<span class="s2">            5	Bh	62.1</span>
<span class="s2">            6	Bh	74.9</span>
<span class="s2">            7	Bh	134</span>
<span class="s2">            8	Bh	148</span>
<span class="s2">            9	Bh	178</span>
<span class="s2">            0	Hs	7.6</span>
<span class="s2">            1	Hs	18.2</span>
<span class="s2">            2	Hs	29.3</span>
<span class="s2">            3	Hs	37.7</span>
<span class="s2">            4	Hs	51.2</span>
<span class="s2">            5	Hs	64</span>
<span class="s2">            6	Hs	78.1</span>
<span class="s2">            7	Hs	91.7</span>
<span class="s2">            8	Hs	159.9</span>
<span class="s2">            9	Hs	173.9</span>
<span class="s2">            4	Mt	50</span>
<span class="s2">            5	Mt	</span>
<span class="s2">            6	Mt	</span>
<span class="s2">            7	Mt	94</span>
<span class="s2">            8	Mt	109</span>
<span class="s2">            9	Mt	187</span>
<span class="s2">            5	Ds	65</span>
<span class="s2">            6	Ds	</span>
<span class="s2">            7	Ds	</span>
<span class="s2">            8	Ds	112.9</span>
<span class="s2">            9	Ds	128</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">KIEs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">continue</span>     <span class="c1"># skip blank or malformed lines</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">energy</span> <span class="o">=</span> <span class="n">parts</span>
        <span class="n">KIEs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">energy</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">KIEs</span></div>


<div class="viewcode-block" id="HighestKnownONs"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.HighestKnownONs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">HighestKnownONs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the highest known oxidation states for each metal element.</span>

<span class="sd">    Returns:</span>
<span class="sd">        HKONs (dict[str, int]) : dictionary with metal element symbols as keys</span>
<span class="sd">                              and their highest known oxidation state as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">data_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        H	-1	1										</span>
<span class="s2">            He												</span>
<span class="s2">            Li	1											</span>
<span class="s2">            Be	0	1	2									</span>
<span class="s2">            B	-5	-1	0	1	2	3						</span>
<span class="s2">            C	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            N	-3	-2	-1	1	2	3	4	5				</span>
<span class="s2">            O	-2	-1	0	1	2							</span>
<span class="s2">            F	-1	0										</span>
<span class="s2">            Ne												</span>
<span class="s2">            Na	-1	1										</span>
<span class="s2">            Mg	0	1	2									</span>
<span class="s2">            Al	-2	-1	1	2	3							</span>
<span class="s2">            Si	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            P	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            S	-2	-1	0	1	2	3	4	5	6			</span>
<span class="s2">            Cl	-1	1	2	3	4	5	6	7				</span>
<span class="s2">            Ar	0											</span>
<span class="s2">            K	-1	1										</span>
<span class="s2">            Ca	0	1	2									</span>
<span class="s2">            Sc	0	1	2	3								</span>
<span class="s2">            Ti	-2	-1	0	1	2	3	4					</span>
<span class="s2">            V	-3	1	0	1	2	3	4	5				</span>
<span class="s2">            Cr	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Mn	-3	-2	-1	0	1	2	3	4	5	6	7	</span>
<span class="s2">            Fe	-4	-2	-1	0	1	2	3	4	5	6	7	</span>
<span class="s2">            Co	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            Ni	-2	-1	0	1	2	3	4					</span>
<span class="s2">            Cu	-2	0	1	2	3	4						</span>
<span class="s2">            Zn	-2	0	1	2								</span>
<span class="s2">            Ga	-5	-4	-3	-2	-1	1	2	3				</span>
<span class="s2">            Ge	-3	-2	-1	0	1	2	3	4				</span>
<span class="s2">            As	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            Se	-2	-1	1	2	3	4	5	6				</span>
<span class="s2">            Br	-1	1	3	4	5	7						</span>
<span class="s2">            Kr	0	1	2									</span>
<span class="s2">            Rb	-1	1										</span>
<span class="s2">            Sr	0	1	2									</span>
<span class="s2">            Y	0	1	2	3								</span>
<span class="s2">            Zr	-2	0	1	2	3	4						</span>
<span class="s2">            Nb	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            Mo	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Tc	-3	-1	0	1	2	3	4	5	6	7		</span>
<span class="s2">            Ru	-4	-2	0	1	2	3	4	5	6	7	8	</span>
<span class="s2">            Rh	-3	-1	0	1	2	3	4	5	6			</span>
<span class="s2">            Pd	0	1	2	3	4							</span>
<span class="s2">            Ag	-2	-1	1	2	3							</span>
<span class="s2">            Cd	-2	1	2									</span>
<span class="s2">            In	-5	-2	-2	1	2	3						</span>
<span class="s2">            Sn	-4	-3	-2	-1	0	1	2	3	4			</span>
<span class="s2">            Sb	-3	-2	-1	0	1	2	3	4	5			</span>
<span class="s2">            Te	-2	-1	1	3	4	5	6	7				</span>
<span class="s2">            I	-1	1	3	4	5	6	7					</span>
<span class="s2">            Xe	0	2	4	6	8							</span>
<span class="s2">            Cs	-1	1										</span>
<span class="s2">            Ba	0	1	2									</span>
<span class="s2">            La	0	1	2	3								</span>
<span class="s2">            Ce	0	2	3	4								</span>
<span class="s2">            Pr	0	1	2	3	4	5						</span>
<span class="s2">            Nd	0	2	3	4								</span>
<span class="s2">            Pm	2	3										</span>
<span class="s2">            Sm	0	2	3									</span>
<span class="s2">            Eu	0	2	3									</span>
<span class="s2">            Gd	0	1	2	3								</span>
<span class="s2">            Tb	0	1	2	3	4							</span>
<span class="s2">            Dy	0	2	3	4								</span>
<span class="s2">            Ho	0	2	3									</span>
<span class="s2">            Er	0	2	3									</span>
<span class="s2">            Tm	0	2	3									</span>
<span class="s2">            Yb	0	2	3									</span>
<span class="s2">            Lu	0	2	3									</span>
<span class="s2">            Hf	-2	0	1	2	3	4						</span>
<span class="s2">            Ta	-3	-1	0	1	2	3	4	5				</span>
<span class="s2">            W	-4	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Re	-3	-1	0	1	2	3	4	5	6	7		</span>
<span class="s2">            Os	-4	-2	-1	0	1	2	3	4	5	6	7	8</span>
<span class="s2">            Ir	-3	-1	0	1	2	3	4	5	6	7	8	9</span>
<span class="s2">            Pt	-3	-2	-1	0	1	2	3	4	5	6		</span>
<span class="s2">            Au	-3	-2	-1	0	1	2	3	5				</span>
<span class="s2">            Hg	-2	1	2									</span>
<span class="s2">            Tl	-5	-2	-1	1	2	3						</span>
<span class="s2">            Pb	-4	-2	-1	1	2	3	4					</span>
<span class="s2">            Bi	-3	-2	-1	1	2	3	4	5				</span>
<span class="s2">            Po	-2	2	4	5	6							</span>
<span class="s2">            At	-1	1	3	5	7							</span>
<span class="s2">            Rn	2	6										</span>
<span class="s2">            Fr	1											</span>
<span class="s2">            Ra	2											</span>
<span class="s2">            Ac	2	3										</span>
<span class="s2">            Th	1	2	3	4								</span>
<span class="s2">            Pa	3	4	5									</span>
<span class="s2">            U	1	2	3	4	5	6						</span>
<span class="s2">            Np	2	3	4	5	6	7						</span>
<span class="s2">            Pu	2	3	4	5	6	7	8					</span>
<span class="s2">            Am	2	3	4	5	6	7						</span>
<span class="s2">            Cm	3	4	5	6								</span>
<span class="s2">            Bk	2	3	4	5								</span>
<span class="s2">            Cf	2	3	4	5								</span>
<span class="s2">            Es	2	3	4									</span>
<span class="s2">            Fm	2	3										</span>
<span class="s2">            Md	2	3										</span>
<span class="s2">            No	2	3										</span>
<span class="s2">            Lr	3											</span>
<span class="s2">            Rf	4											</span>
<span class="s2">            Db	5											</span>
<span class="s2">            Sg	0	6										</span>
<span class="s2">            Bh	7											</span>
<span class="s2">            Hs	8											</span>
<span class="s2">            Mt												</span>
<span class="s2">            Ds												</span>
<span class="s2">            Rg												</span>
<span class="s2">            Cn	2											</span>
<span class="s2">            Nh												</span>
<span class="s2">            Fl												</span>
<span class="s2">            Mc												</span>
<span class="s2">            Lv												</span>
<span class="s2">            Ts												</span>
<span class="s2">            Og						</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">HKONs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># ignore entries with no numeric states</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># convert all remaining tokens to ints, take the max</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="n">HKONs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if no oxidation state listed, set to 0 or remove entirely</span>
            <span class="n">HKONs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">HKONs</span></div>


<div class="viewcode-block" id="ONprobabilities"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.ONprobabilities">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">ONprobabilities</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in the probability of each oxidation state for all metal elements.</span>
<span class="sd">    Approximate probabilities are assessed by their relative frequency of</span>
<span class="sd">    occurence in the CSD metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ONP (dict[str, list[float]]): dictionary with metal element symbols as keys</span>
<span class="sd">                        and a list of the probability at the relevant oxidation</span>
<span class="sd">                        states as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Li	0	0.993162393	0.003418803	0.001709402	0.001709402	0	0	0	0	0	0</span>
<span class="s2">                    Be	0.023529412	0	0.976470588	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Na	0	0.998743719	0	0.001256281	0	0	0	0	0	0	0</span>
<span class="s2">                    Mg	0.002141328	0.016416845	0.981441827	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Al	0	0.020121951	0.016463415	0.962804878	0.000609756	0	0	0	0	0	0</span>
<span class="s2">                    K	0	0.998137803	0	0.001862197	0	0	0	0	0	0	0</span>
<span class="s2">                    Ca	0	0.001176471	0.998823529	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Sc	0	0.003656307	0.010968921	0.985374771	0	0	0	0	0	0	0</span>
<span class="s2">                    Ti	0.004095004	0.00020475	0.028460278	0.128992629	0.838247338	0	0	0	0	0	0</span>
<span class="s2">                    V	0.002768166	0.007612457	0.037197232	0.133564014	0.391868512	0.426816609	0.00017301	0	0	0	0</span>
<span class="s2">                    Cr	0.160139589	0.017836371	0.138037999	0.612252811	0.014928267	0.018805739	0.037999225	0	0	0	0</span>
<span class="s2">                    Mn	0.001919631	0.044599437	0.64864346	0.260621961	0.039928334	0.003519324	0.000319939	0.000447914	0	0	0</span>
<span class="s2">                    Fe	0.016919249	0.011083465	0.545216014	0.42053834	0.0059715	0.000226193	4.52E-05	0	0	0	0</span>
<span class="s2">                    Co	0.002508241	0.021678372	0.655403469	0.31990827	0.00035832	0.000143328	0	0	0	0	0</span>
<span class="s2">                    Ni	0.020168417	0.010846588	0.935890772	0.031222927	0.001871296	0	0	0	0	0	0</span>
<span class="s2">                    Cu	6.78E-05	0.236206984	0.75977341	0.003951765	0	0	0	0	0	0	0</span>
<span class="s2">                    Zn	7.78E-05	0.000778362	0.999104884	3.89E-05	0	0	0	0	0	0	0</span>
<span class="s2">                    Ga	0.003392706	0.100932994	0.066157761	0.828668363	0.000848176	0	0	0	0	0	0</span>
<span class="s2">                    Rb	0	0.9875	0.0125	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Sr	0	0	1	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Y	0.000608273	0.000608273	0.001824818	0.996350365	0.000608273	0	0	0	0	0	0</span>
<span class="s2">                    Zr	0.001476378	0	0.030019685	0.039370079	0.928149606	0	0.000984252	0	0	0	0</span>
<span class="s2">                    Nb	0.006417112	0.03315508	0.02459893	0.100534759	0.19144385	0.643850267	0	0	0	0	0</span>
<span class="s2">                    Mo	0.067368705	0.007830431	0.106115836	0.052922911	0.132847307	0.184150128	0.448764682	0	0	0	0</span>
<span class="s2">                    Tc	0	0.1488	0.0592	0.2256	0.056	0.4288	0.04	0.0416	0	0	0</span>
<span class="s2">                    Ru	0.01519372	0.011901747	0.819870009	0.119355111	0.027348696	0.000759686	0.005571031	0	0	0	0</span>
<span class="s2">                    Rh	0.002670673	0.455850442	0.141545652	0.397095643	0.00166917	0.001168419	0	0	0	0	0</span>
<span class="s2">                    Pd	0.018729923	0.009834445	0.961255251	0.004101804	0.005979738	9.88E-05	0	0	0	0	0</span>
<span class="s2">                    Ag	0.000163733	0.988784282	0.006631191	0.004420794	0	0	0	0	0	0	0</span>
<span class="s2">                    Cd	0	0.000421977	0.998818466	0.000759558	0	0	0	0	0	0	0</span>
<span class="s2">                    In	0	0.056062581	0.024771838	0.91916558	0	0	0	0	0	0	0</span>
<span class="s2">                    Sn	0.00222187	0.00095223	0.194730995	0.001110935	0.800666561	0.000158705	0.000158705	0	0	0	0</span>
<span class="s2">                    Cs	0	0.986486486	0.013513514	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Ba	0	0	0.998236332	0.001763668	0	0	0	0	0	0	0</span>
<span class="s2">                    Hf	0	0	0.015473888	0.025145068	0.959381044	0	0	0	0	0	0</span>
<span class="s2">                    Ta	0.003726708	0.016149068	0.01242236	0.068322981	0.116770186	0.782608696	0	0	0	0	0</span>
<span class="s2">                    W	0.128280743	0.003538779	0.131229726	0.027720436	0.146564435	0.130934827	0.431731053	0	0	0	0</span>
<span class="s2">                    Re	0.001812324	0.316149819	0.044905356	0.124043496	0.065243657	0.364679823	0.017921869	0.065243657	0	0	0</span>
<span class="s2">                    Os	0.009817672	0.005610098	0.460729313	0.140953717	0.204067321	0.016830295	0.152173913	0.000701262	0.00911641	0	0</span>
<span class="s2">                    Ir	0.001902045	0.201854494	0.027104137	0.752258678	0.011650024	0.005230623	0	0	0	0	0</span>
<span class="s2">                    Pt	0.017449918	0.005606652	0.844021671	0.01870984	0.114085927	0	0.000125992	0	0	0	0</span>
<span class="s2">                    Au	0.001029204	0.731892448	0.015824006	0.251125691	0.00012865	0	0	0	0	0	0</span>
<span class="s2">                    Hg	0.00251004	0.013805221	0.983433735	0.000251004	0	0	0	0	0	0	0</span>
<span class="s2">                    Tl	0.001342282	0.616107383	0.013422819	0.369127517	0	0	0	0	0	0	0</span>
<span class="s2">                    Pb	0	0.000545852	0.964792576	0.000272926	0.034388646	0	0	0	0	0	0</span>
<span class="s2">                    Bi	0	0	0	1	0	0	0	0	0	0	0</span>
<span class="s2">                    Po	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Fr	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Ra	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Rf	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Db	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Sg	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Bh	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Hs	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Mt	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Ds	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Rg	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Cn	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Nh	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Fl	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Mc	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Lv	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    La	0	0	0.002631579	0.996842105	0.000526316	0	0	0	0	0	0</span>
<span class="s2">                    Ce	0	0.000666223	0.005996003	0.742838108	0.250499667	0	0	0	0	0	0</span>
<span class="s2">                    Pr	0	0	0.002636204	0.993848858	0.003514938	0	0	0	0	0	0</span>
<span class="s2">                    Nd	0	0	0.005083884	0.994916116	0	0	0	0	0	0	0</span>
<span class="s2">                    Pm	0	0	0	1	0	0	0	0	0	0	0</span>
<span class="s2">                    Sm	0	0	0.153056235	0.846943765	0	0	0	0	0	0	0</span>
<span class="s2">                    Eu	0	0	0.081716037	0.918283963	0	0	0	0	0	0	0</span>
<span class="s2">                    Gd	0.000430663	0	0.005167959	0.994401378	0	0	0	0	0	0	0</span>
<span class="s2">                    Tb	0	0	0.132275132	0.866717057	0.001007811	0	0	0	0	0	0</span>
<span class="s2">                    Dy	0	0	0.007676768	0.992323232	0	0	0	0	0	0	0</span>
<span class="s2">                    Ho	0.001218027	0	0.007308161	0.990255786	0.001218027	0	0	0	0	0	0</span>
<span class="s2">                    Er	0	0	0.099644793	0.899233502	0.001121705	0	0	0	0	0	0</span>
<span class="s2">                    Tm	0	0	0.112903226	0.887096774	0	0	0	0	0	0	0</span>
<span class="s2">                    Yb	0	0	0.268343816	0.731656184	0	0	0	0	0	0	0</span>
<span class="s2">                    Lu	0	0	0.003663004	0.996336996	0	0	0	0	0	0	0</span>
<span class="s2">                    Ac	0	0	0	0	0.333333333	0.666666667	0	0	0	0	0</span>
<span class="s2">                    Th	0	0	0.008896797	0.019572954	0.96975089	0	0.001779359	0	0	0	0</span>
<span class="s2">                    Pa	0	0	0	0	0.333333333	0.666666667	0	0	0	0	0</span>
<span class="s2">                    U	0.000308452	0	0.003701419	0.098704503	0.333127699	0.064466379	0.499691548	0	0	0	0</span>
<span class="s2">                    Np	0	0	0.004048583	0.04048583	0.246963563	0.453441296	0.251012146	0.004048583	0	0	0</span>
<span class="s2">                    Pu	0	0	0	0.231292517	0.510204082	0.040816327	0.217687075	0	0	0	0</span>
<span class="s2">                    Am	0	0	0	0.857142857	0	0.057142857	0.085714286	0	0	0	0</span>
<span class="s2">                    Cm	0	0	0	1	0	0	0	0	0	0	0</span>
<span class="s2">                    Bk	0	0	0	1	0	0	0	0	0	0	0</span>
<span class="s2">                    Cf	0	0	0	1	0	0	0	0	0	0	0</span>
<span class="s2">                    Es	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Fm	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Md	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    No	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Lr	0	0	0	0	0	0	0	0	0	0	0</span>
<span class="s2">                    Ge	0.00867052	0.012524085	0.512524085	0.002890173	0.462427746	0	0.000963391	0	0	0	0</span>
<span class="s2">                    As	0	0.021459227	0	0.811158798	0	0.167381974	0	0	0	0	0</span>
<span class="s2">                    Se	0	0.023809524	0.619047619	0	0.325396825	0	0.031746032	0	0	0	0</span>
<span class="s2">                    Sb	0	0.002742732	0	0.541963796	0.000548546	0.45419638	0.000548546	0	0	0	0</span>
<span class="s2">                    Te	0	0.001194743	0.338112306	0.001194743	0.628434886	0	0.031063321	0	0	0	0</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">ONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># tab/space 都能分</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">ONP</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs</span>

    <span class="k">return</span> <span class="n">ONP</span></div>


<div class="viewcode-block" id="ONmostprob"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.ONmostprob">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">ONmostprob</span><span class="p">(</span><span class="n">iONP</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the highest probability oxidation state for each metal element.</span>
<span class="sd">    These values are utilized during charge distribution routines.</span>

<span class="sd">    Args:</span>
<span class="sd">        iONP (dict[str, list[float]]): dictionary with metal element symbols as</span>
<span class="sd">                        keys and a list of the probability at the relevant oxidation</span>
<span class="sd">                        states as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MPOS (dict[str, int]) : dictionary with metal element symbols as keys and</span>
<span class="sd">                        their oxidation state with the highest probability as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MPOS</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">iONP</span><span class="p">:</span>
        <span class="n">hprob</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iONP</span><span class="p">[</span><span class="n">metal</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;=</span> <span class="n">hprob</span><span class="p">:</span>
                <span class="n">hprob</span> <span class="o">=</span> <span class="n">prob</span>
                <span class="n">MPOS</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">MPOS</span></div>


<div class="viewcode-block" id="getCN"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.getCN">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">getCN</span><span class="p">(</span><span class="n">lsites</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Atom</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Atom</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Molecule</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the highest probability oxidation state for each metal element.</span>
<span class="sd">    These values are utilized during charge distribution routines.</span>

<span class="sd">    Args:</span>
<span class="sd">        lsites (dict[Atom, list[Atom]]): dictionary with metal Atom object as keys</span>
<span class="sd">                        and the list of ligand atoms which bind them as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CNdict (dict[Molecule, int]): dictionary with as metal Atom objects as</span>
<span class="sd">                        keys and effective coordination number as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CNdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">lsites</span><span class="p">:</span>
        <span class="n">CNdict</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ligand</span> <span class="ow">in</span> <span class="n">lsites</span><span class="p">[</span><span class="n">metal</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">hapticity</span><span class="p">(</span><span class="n">ligand</span><span class="p">,</span> <span class="n">metal</span><span class="p">):</span>
                <span class="n">CNdict</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CNdict</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">neighbour</span> <span class="ow">in</span> <span class="n">metal</span><span class="o">.</span><span class="n">neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">neighbour</span><span class="o">.</span><span class="n">is_metal</span><span class="p">:</span>
                <span class="n">CNdict</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">CNdict</span></div>


<span class="n">KnownON</span>  <span class="o">=</span> <span class="n">KnownONs</span><span class="p">()</span>
<span class="n">KnownIE</span>  <span class="o">=</span> <span class="n">IonizationEnergies</span><span class="p">()</span>
<span class="n">HighestKnownON</span> <span class="o">=</span> <span class="n">HighestKnownONs</span><span class="p">()</span>
<span class="n">ONProb</span>   <span class="o">=</span> <span class="n">ONprobabilities</span><span class="p">()</span>
<span class="n">HighestProbON</span> <span class="o">=</span> <span class="n">ONmostprob</span><span class="p">(</span><span class="n">ONProb</span><span class="p">)</span>


<div class="viewcode-block" id="check"><a class="viewcode-back" href="../../CoREMOF.html#CoREMOF.mosaec.check">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process a single .cif or .mol2 file and return a dict mapping each metal site</span>
<span class="sd">    label to the list of flag-names that are not &#39;GOOD&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read structure</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.cif&quot;</span><span class="p">):</span>
            <span class="n">cif</span> <span class="o">=</span> <span class="n">readentry</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">molecule</span>
            <span class="n">asymmol</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">asymmetric_unit_molecule</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">readSBU</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">asymmol</span> <span class="o">=</span> <span class="n">mol</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># Identify sites</span>
    <span class="n">uniquesites</span> <span class="o">=</span> <span class="n">get_unique_sites</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asymmol</span><span class="p">)</span>
    <span class="n">metalsites</span> <span class="o">=</span> <span class="n">get_metal_sites</span><span class="p">(</span><span class="n">uniquesites</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">metalsites</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># Bonding and oxidation contributions</span>
    <span class="n">dVBO</span> <span class="o">=</span> <span class="n">delocalisedLBO</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">rVBO</span> <span class="o">=</span> <span class="n">ringVBOs</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">AON</span> <span class="o">=</span> <span class="n">iVBS_Oxidation_Contrib</span><span class="p">(</span><span class="n">uniquesites</span><span class="p">,</span> <span class="n">rVBO</span><span class="p">,</span> <span class="n">dVBO</span><span class="p">)</span>
    <span class="n">rAON</span> <span class="o">=</span> <span class="n">redundantAON</span><span class="p">(</span><span class="n">AON</span><span class="p">,</span> <span class="n">mol</span><span class="p">)</span>
    <span class="n">ligand_sites</span> <span class="o">=</span> <span class="n">get_ligand_sites</span><span class="p">(</span><span class="n">metalsites</span><span class="p">,</span> <span class="n">uniquesites</span><span class="p">)</span>
    <span class="n">binding_sites</span> <span class="o">=</span> <span class="n">get_binding_sites</span><span class="p">(</span><span class="n">metalsites</span><span class="p">,</span> <span class="n">uniquesites</span><span class="p">)</span>
    <span class="n">binding_sphere</span> <span class="o">=</span> <span class="n">binding_domain</span><span class="p">(</span><span class="n">binding_sites</span><span class="p">,</span> <span class="n">rAON</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="p">{</span><span class="n">u</span><span class="o">.</span><span class="n">label</span><span class="p">:</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniquesites</span><span class="p">})</span>
    <span class="n">bindingAON</span> <span class="o">=</span> <span class="n">binding_contrib</span><span class="p">(</span><span class="n">binding_sphere</span><span class="p">,</span> <span class="n">binding_sites</span><span class="p">,</span> <span class="n">rAON</span><span class="p">)</span>
    <span class="n">connected</span> <span class="o">=</span> <span class="n">get_metal_networks</span><span class="p">(</span><span class="n">ligand_sites</span><span class="p">,</span> <span class="n">binding_sphere</span><span class="p">,</span> <span class="n">bindingAON</span><span class="p">)</span>
    <span class="n">mCN</span> <span class="o">=</span> <span class="n">getCN</span><span class="p">(</span><span class="n">ligand_sites</span><span class="p">)</span>

    <span class="c1"># ONE-center inner</span>
    <span class="n">ONEC_inner</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">:</span>
        <span class="n">oxidation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">valence_e</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lig</span> <span class="ow">in</span> <span class="n">ligand_sites</span><span class="p">[</span><span class="n">metal</span><span class="p">]:</span>
            <span class="n">LBO</span> <span class="o">=</span> <span class="n">bindingAON</span><span class="p">[</span><span class="n">lig</span><span class="p">]</span>
            <span class="n">Nbr</span> <span class="o">=</span> <span class="n">bridging</span><span class="p">(</span><span class="n">lig</span><span class="p">)</span>
            <span class="n">Ox</span> <span class="o">=</span> <span class="n">LBO</span> <span class="o">/</span> <span class="n">Nbr</span>
            <span class="n">oxidation</span> <span class="o">+=</span> <span class="n">Ox</span>
            <span class="k">if</span> <span class="n">Ox</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">mCN</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">Ox</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">mCN</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ONEC_inner</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">oxidation</span><span class="p">,</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">mCN</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">-</span> <span class="n">oxidation</span><span class="p">]</span>

    <span class="c1"># Network distribution</span>
    <span class="n">noint_balance</span> <span class="o">=</span> <span class="n">distribute_ONEC</span><span class="p">(</span><span class="n">ONEC_inner</span><span class="p">,</span> <span class="n">connected</span><span class="p">,</span> <span class="n">KnownIE</span><span class="p">,</span> <span class="n">ONProb</span><span class="p">,</span> <span class="n">HighestKnownON</span><span class="p">,</span> <span class="n">mCN</span><span class="p">,</span> <span class="n">HighestProbON</span><span class="p">)</span>

    <span class="c1"># Outer-sphere</span>
    <span class="n">OSC</span> <span class="o">=</span> <span class="n">outer_sphere_contrib</span><span class="p">(</span><span class="n">outer_sphere_domain</span><span class="p">(</span><span class="n">uniquesites</span><span class="p">,</span> <span class="n">binding_sphere</span><span class="p">),</span> <span class="n">rAON</span><span class="p">)</span>
    <span class="n">noint_outer</span> <span class="o">=</span> <span class="n">distribute_OuterSphere</span><span class="p">(</span><span class="n">noint_balance</span><span class="p">,</span> <span class="n">OSC</span><span class="p">,</span> <span class="n">KnownIE</span><span class="p">,</span> <span class="n">ONProb</span><span class="p">,</span> <span class="n">HighestKnownON</span><span class="p">,</span> <span class="n">mCN</span><span class="p">)</span>

    <span class="c1"># Prepare flag dictionaries</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;impossible&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_valence&quot;</span><span class="p">,</span> <span class="s2">&quot;noint_flag&quot;</span><span class="p">,</span>
        <span class="s2">&quot;low_prob_1&quot;</span><span class="p">,</span> <span class="s2">&quot;low_prob_2&quot;</span><span class="p">,</span> <span class="s2">&quot;low_prob_3&quot;</span><span class="p">,</span> <span class="s2">&quot;low_prob_multi&quot;</span>
    <span class="p">]}</span>

    <span class="c1"># Evaluate flags</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">noint_outer</span><span class="p">:</span>
        <span class="n">lbl</span> <span class="o">=</span> <span class="n">metal</span><span class="o">.</span><span class="n">label</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;impossible&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>    <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;zero_valence&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>       <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;noint_flag&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>         <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_1&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>         <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_2&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>         <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_3&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>         <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_multi&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span>     <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
        
        <span class="n">val</span> <span class="o">=</span> <span class="n">valence_e</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span>
        <span class="n">os_val</span> <span class="o">=</span> <span class="n">noint_outer</span><span class="p">[</span><span class="n">metal</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">os_val</span> <span class="o">&gt;</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;impossible&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BAD&quot;</span>
        <span class="k">if</span> <span class="n">os_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;zero_valence&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BAD&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">os_val</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">KnownON</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">]):</span>
            <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BAD&quot;</span>
        <span class="c1"># low-prob checks</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">os_val</span> <span class="o">%</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">):</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">ONProb</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">][</span><span class="nb">round</span><span class="p">(</span><span class="n">os_val</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">os_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ONProb</span><span class="p">[</span><span class="n">metal</span><span class="o">.</span><span class="n">atomic_symbol</span><span class="p">])</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_1&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LIKELY_BAD&quot;</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_2&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BAD&quot;</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                <span class="n">flags</span><span class="p">[</span><span class="s2">&quot;low_prob_3&quot;</span><span class="p">][</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BAD&quot;</span>
        
    <span class="k">return</span> <span class="n">flags</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, MTAP @ Pusan National University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>